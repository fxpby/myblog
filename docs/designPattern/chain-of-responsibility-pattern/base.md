# è´£ä»»é“¾æ¨¡å¼ Chain of Responsibility Pattern

## ä»‹ç»

- ä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»è€Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ç›´æ¥çš„è€¦åˆå…³ç³»
- å°†å¤šä¸ªå¯¹è±¡è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯¥è¯·æ±‚ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢

## ç¤ºä¾‹

### å”®å–ç”µè„‘

å‡è®¾æœ‰ä¸€ä¸ªè´Ÿè´£å”®å–ç”µè„‘çš„ç”µå•†ç½‘ç«™ï¼Œç»è¿‡åˆ†åˆ«äº¤çº³ 500 å…ƒå®šé‡‘å’Œ 200 å…ƒå®šé‡‘çš„ä¸¤è½®é¢„å®šåï¼ˆè®¢å•å·²ç»ç”Ÿæˆï¼‰ï¼Œç°åœ¨å·²ç»åˆ°äº†æ­£å¼è´­ä¹°çš„é˜¶æ®µã€‚

å…¬å¸é’ˆå¯¹æ”¯ä»˜è¿‡å®šé‡‘çš„ç”¨æˆ·æœ‰ä¼˜æƒ æ”¿ç­–ã€‚æ­£å¼è´­ä¹°åï¼Œå·²ç»æ”¯ä»˜è¿‡ 500 å…ƒå®šé‡‘çš„ç”¨æˆ·ä¼šæ”¶åˆ° 100 å…ƒçš„å•†åŸä¼˜æƒ åˆ¸ï¼Œæ”¯ä»˜è¿‡ 200 å…ƒå®šé‡‘çš„ç”¨æˆ·å¯ä»¥æ”¶åˆ° 50 å…ƒçš„ä¼˜æƒ åˆ¸ï¼Œæ²¡æœ‰æ”¯ä»˜å®šé‡‘çš„ç”¨æˆ·æ²¡æœ‰ä¼˜æƒ åˆ¸ï¼Œä¸”åº“å­˜æœ‰é™æ—¶ä¸ä¸€å®šä¿è¯ä¹°åˆ°ã€‚

åç«¯ç»™æˆ‘ä»¬è¿”å›çš„æ•°æ®æœ‰

- orderTypeï¼šè®¢å•ç±»å‹ï¼ˆå®šé‡‘è´­ä¹°æˆ–è€…æ™®é€šè´­ä¹°ï¼‰ï¼Œ1 ä¸º æ”¯ä»˜ 500 å…ƒå®šé‡‘ï¼Œ2 ä¸ºæ”¯ä»˜ 200 å…ƒå®šé‡‘ï¼Œ3 ä¸ºæœªæ”¯ä»˜å®šé‡‘æ™®é€šè´­ä¹°ã€‚
- pay: æ˜¯å¦å·²ç»æ”¯ä»˜å®šé‡‘ã€‚true ä¸ºç”¨æˆ·å·²ç»æ”¯ä»˜å®šé‡‘ï¼Œfalse ä¸ºç”¨æˆ·æäº¤å®šé‡‘è®¢å•ä½†å´æ²¡æœ‰æ”¯ä»˜å®šé‡‘ï¼Œé™çº§ä¸ºæœªæ”¯ä»˜å®šé‡‘æ™®é€šè´­ä¹°æ¨¡å¼
- stock: æ™®é€šè´­ä¹°å•†å“çš„åº“å­˜æ•°é‡ï¼Œæ”¯ä»˜å®šé‡‘çš„ç”¨æˆ·ä¸å—æ­¤é™åˆ¶

```js
const order = (orderType, pay, stock) => {
  // 500 å…ƒå®šé‡‘è´­ä¹°
  if (orderType === 1) {
    // å·²æ”¯ä»˜å®šé‡‘
    if (pay === true) {
      console.log(`500 å…ƒå®šé‡‘é¢„è´­ï¼Œè·å¾— 100 å…ƒä¼˜æƒ åˆ¸`)
    } else {
      // æ™®é€šè´­ä¹°æ¨¡å¼çš„æ‰‹æœºæœ‰åº“å­˜
      if (stock > 0) {
        console.log(`æ™®é€šè´­ä¹°ï¼Œæ²¡æœ‰ä¼˜æƒ åˆ¸`)
      } else {
        console.log(`ç”µè„‘åº“å­˜ä¸è¶³`)
      }
    }
  // 200 å…ƒå®šé‡‘è´­ä¹°
  } else if (orderType === 2) {
    // å·²æ”¯ä»˜å®šé‡‘
    if (pay === true) {
      console.log(`200 å…ƒå®šé‡‘é¢„è´­ï¼Œè·å¾— 50 å…ƒä¼˜æƒ åˆ¸`)
    } else {
      if (stock > 0) {
        console.log(`æ™®é€šè´­ä¹°ï¼Œæ²¡æœ‰ä¼˜æƒ åˆ¸`)
      } else {
        console.log(`ç”µè„‘åº“å­˜ä¸è¶³`)
      }
    }
  } else if (orderType === 3) {
    if (stock > 0) {
      console.log(`æ™®é€šè´­ä¹°ï¼Œæ²¡æœ‰ä¼˜æƒ åˆ¸`)
    } else {
      console.log(`ç”µè„‘åº“å­˜ä¸è¶³`)
    }
  }
}

order(1, true, 500) // 500 å…ƒå®šé‡‘é¢„è´­ï¼Œè·å¾— 100 å…ƒä¼˜æƒ åˆ¸
```

ä¸Šé¢è¿™ä¸ªå‡½æ•°ï¼Œè¿è¡Œæ­£ç¡®ã€‚but è¿™ä¸ª if...else å¾ˆå¤šï¼Œé˜…è¯»èµ·æ¥ä¸èˆ’é€‚ï¼Œåç»­ç»´æŠ¤ä¹Ÿä¼šä»¤äººå¤´å¤§ã€‚

å¦‚æœé‡‡ç”¨èŒè´£é“¾æ¨¡å¼é‡æ„çš„è¯ï¼Œå¯ä»¥å…ˆæŠŠ 500 å…ƒè®¢å•ã€200 å…ƒè®¢å•å’Œæ™®é€šè´­ä¹°è®¢å•åˆ†æˆ 3 ä¸ªå‡½æ•°ã€‚æŠŠ orderTypeã€payã€stock è¿™ä¸‰ä¸ªå­—æ®µä½œä¸ºå‚æ•°ä¼ é€’ç»™ 500 å…ƒè®¢å•å‡½æ•°ï¼Œå¦‚æœè¯¥å‡½æ•°ä¸ç¬¦åˆå¤„ç†æ¡ä»¶å°±æŠŠè¿™ä¸ªè¯·æ±‚ä¼ é€’ç»™åé¢ 200 å…ƒè®¢å•å‡½æ•°ï¼Œå¦‚æœ 200 å…ƒè®¢å•å‡½æ•°ä¾ç„¶ä¸èƒ½å¤„ç†ï¼Œå°±ç»§ç»­ä¼ é€’ç»™æ™®é€šè´­ä¹°è®¢å•å‡½æ•°ã€‚

```js
const order500 = (orderType, pay, stock) => {
  if (orderType === 1 && pay === true) {
    console.log(`500 å…ƒå®šé‡‘é¢„è´­ï¼Œè·å¾— 100 å…ƒä¼˜æƒ åˆ¸`)
  } else {
    // ä¼ é€’è¯·æ±‚ç»™ 200 å…ƒè®¢å•
    order200(orderType, pay, stock)
  }
}

const order200 = (orderType, pay, stock) => {
  if (orderType === 2 && pay === true) {
    console.log(`200 å…ƒå®šé‡‘é¢„è´­ï¼Œè·å¾— 50 å…ƒä¼˜æƒ åˆ¸`)
  } else {
    // ä¼ é€’ç»™æ™®é€šè´­ä¹°è®¢å•
    orderNormal(orderType, pay, stock)
  }
}

const orderNormal = (orderType, pay, stock) => {
  if (stock > 0) {
    console.log(`æ™®é€šè´­ä¹°ï¼Œæ²¡æœ‰ä¼˜æƒ åˆ¸`)
  } else {
    console.log(`ç”µè„‘åº“å­˜ä¸è¶³`)
  }
}

order500(1, true, 500) // 500 å…ƒå®šé‡‘é¢„è´­ï¼Œè·å¾— 100 å…ƒä¼˜æƒ åˆ¸
order500(1, false, 500) // æ™®é€šè´­ä¹°ï¼Œæ²¡æœ‰ä¼˜æƒ åˆ¸
order500(2, true, 500) // 200 å…ƒå®šé‡‘é¢„è´­ï¼Œè·å¾— 50 å…ƒä¼˜æƒ åˆ¸
order500(3, false, 500) // æ™®é€šè´­ä¹°ï¼Œæ²¡æœ‰ä¼˜æƒ åˆ¸
order500(3, false, 0) // ç”µè„‘åº“å­˜ä¸è¶³
```

è¿™æ ·é‡æ„å®Œï¼ŒæŠŠä¹‹å‰çš„å¤§å‡½æ•°æ‹†åˆ†æˆ 3 ä¸ªäº’ä¸å½±å“çš„å°å‡½æ•°ï¼Œä½†æ˜¯ä¼ é€’è¯·æ±‚çš„ä»£ç è¿˜æ˜¯è€¦åˆåœ¨ä¸šåŠ¡å‡½æ•°é‡Œé¢ï¼Œæ¯”å¦‚ order500 å’Œ order200 è€¦åˆï¼Œorder200 å’Œ orderNormal è€¦åˆã€‚è¿™æ ·çš„è¯ï¼Œå¦‚æœæ—¥åå¢åŠ  300 å…ƒé¢„å®šæˆ–è€…å»é™¤ 200 å…ƒé¢„å®šçš„è¯ï¼Œæˆ‘ä»¬å°±å¿…é¡»å»æ”¹åŠ¨ä¸šåŠ¡å‡½æ•°å†…éƒ¨ï¼Œè¿åäº†å¼€æ”¾å°é—­åŸåˆ™ï¼Œè¿™ä¸ªé“¾æ¡å¾ˆä¸çµæ´»ã€‚

å†æ”¹è¿›ä¸€ä¸‹ï¼Œå¦‚æœæŸä¸€ä¸ªèŠ‚ç‚¹ä¸èƒ½å¤„ç†è¯·æ±‚ï¼Œé‚£ä¹ˆå°±ç»Ÿä¸€è¿”å›ä¸€ä¸ªç‰¹å®šçš„å­—ç¬¦ä¸²æ ‡è¯†`nextSuccessor`æ¥è¡¨ç¤ºè¯·æ±‚éœ€è¦ç»§ç»­å‘åä¼ é€’ğŸ‘‡ğŸ»

```js
const order500 = (orderType, pay, stock) => {
  if (orderType === 1 && pay === true) {
    console.log(`500 å…ƒå®šé‡‘é¢„è´­ï¼Œè·å¾— 100 å…ƒä¼˜æƒ åˆ¸`)
  } else {
    // ä¸è€ƒè™‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯è°ï¼Œåªæ˜¯å‘åä¼ é€’
    return 'nextSuccessor'
  }
}

const order200 = (orderType, pay, stock) => {
  if (orderType === 2 && pay === true) {
    console.log(`200 å…ƒå®šé‡‘é¢„è´­ï¼Œè·å¾— 50 å…ƒä¼˜æƒ åˆ¸`)
  } else {
    // ä¸è€ƒè™‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯è°ï¼Œåªæ˜¯å‘åä¼ é€’
    return 'nextSuccessor'
  }
}

const orderNormal = (orderType, pay, stock) => {
  if (stock > 0) {
    console.log(`æ™®é€šè´­ä¹°ï¼Œæ²¡æœ‰ä¼˜æƒ åˆ¸`)
  } else {
    console.log(`ç”µè„‘åº“å­˜ä¸è¶³`)
  }
}
```

ä¸‹é¢æŠŠå‡½æ•°åŒ…è£…åˆ°èŒè´£é“¾èŠ‚ç‚¹ï¼Œå®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•° Chain, åœ¨ new Chain çš„æ—¶å€™ä¼ é€’éœ€è¦è¢«åŒ…è£…çš„å‡½æ•°ä¸ºå‚æ•°ã€‚åŒæ—¶æ‹¥æœ‰ä¸€ä¸ªå®ä¾‹å±æ€§ this.successorï¼Œç”¨æ¥è¡¨ç¤ºèŒè´£é“¾ä¸­ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚

```js
class Chain {
  constructor(fn) {
    this.fn = fn;
    this.successor = null
  }

  // æŒ‡å®šåœ¨é“¾ä¸­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
  setNextSuccessor(successor) {
    return this.successor = successor;
  }

  // ä¼ é€’è¯·æ±‚ç»™æŸä¸ªèŠ‚ç‚¹
  passRequest() {
    const result = this.fn.apply(this, arguments);
    if (result === 'nextSuccessor') {
      return this.successor && this.successor.passRequest.apply(this.successor, arguments);
    }
    return result
  }
}

const chainOrder500 = new Chain(order500)
const chainOrder200 = new Chain(order200)
const chainOrderNormal = new Chain(orderNormal)

chainOrder500.setNextSuccessor(chainOrder200)
chainOrder200.setNextSuccessor(chainOrderNormal)

chainOrder500.passRequest(1, true, 500)
chainOrder500.passRequest(2, true, 500)
chainOrder500.passRequest(3, true, 500)
chainOrder500.passRequest(1, false, 500)
```

è¿™æ ·å°±ä¸ä¼šè¿èƒŒå¼€æ”¾å°é—­åŸåˆ™äº†ï¼Œæˆ‘ä»¬å¦‚æœéœ€è¦æ”¹åŠ¨ç›¸å…³ä¸šåŠ¡é€»è¾‘ï¼Œåªéœ€è¦æ–°å¢ã€ä¿®æ”¹æˆ–è€…ç§»é™¤èŠ‚ç‚¹é¡ºåºã€‚
