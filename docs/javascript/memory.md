---
id: memory
title: 内存管理
tags:
  - 内存
---

## 为什么要管理内存

### 减少浏览器负担

内存过大会让浏览器压力过大，导致浏览器卡顿

### Node 端 - 做服务

内存如果不够，服务就会中断

## 内存的数据存储

### 栈内存

线性的，后进先出

### 堆内存

非线性，不连续的

### 存储普通类型的变量 - 栈内存

```js
let a = 1
let b = 2
```

- 先入栈 a-123
- 再入栈 b-10

变量直接指向值，变量和值放在一起

### 存储引用类型的变量 - 堆栈

```js
let a = { a1: 123 }
let b = a
let c = [1, 2, 3]
let d = function() { console.log(123) }
{ a2: 666 }
```

- 声明引用类型变量 a 的时候，先在堆内存中开辟一个地址存放变量（变量本体），再把这个地址赋值给变量，即入栈 a-0x00000000
- a b 指向同一地址，所以入栈 b-0x00000000
- 同声明 a, 入栈 c-0x00000005
- 同声明 a, 入栈 d-0x00000008
- 直接定义一个引用类型，在堆内存中开辟一个地址存放变量（变量本体）

## V8 内存的管理

### V8到底有多大

- 64 位下是1.4G（标准）
- 32 位下是 700MB （标准）
- 根据浏览器不同会有些许扩容
- 新版本 Node 也会有自动调用 C++ 内存进行内扩容（动态扩容）

### 新生代和老生代

比如我们 64 位 1.4G 的内存，分为两块

- 新生代：短时间存活的新变量会存在新生代中，新生代的内存量极小，64 位下大概是 32MB
- 老生代：生存时间比较长的变量会转存到老生代，老生代占据了几乎所有内存，64 位下大概是 1400MB

#### 新生代

#### 老生代