"use strict";(self.webpackChunkmy_website_2=self.webpackChunkmy_website_2||[]).push([[3602],{26:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>r,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"coding/framework/vue/vue2-init-process","title":"vue2 \u521d\u59cb\u5316\u8fc7\u7a0b","description":"\u6bcf\u4e2a Vue2 \u9879\u76ee\u7684\u5165\u53e3\u6587\u4ef6\u90fd\u6709 new Vue\uff08options\uff09, \u8fd9\u91cc\u7684\u9b54\u6cd5\u4e00\u8d77\u6765\u63a2\u5bfb\u4e0b\u5427","source":"@site/docs/coding/framework/vue/vue2-init-process.md","sourceDirName":"coding/framework/vue","slug":"/coding/framework/vue/vue2-init-process","permalink":"/docs/coding/framework/vue/vue2-init-process","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/coding/framework/vue/vue2-init-process.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u6e90\u7801\u5b66\u4e60 - \u6784\u5efa","permalink":"/docs/coding/framework/vue/vue2-build"},"next":{"title":"\u6e90\u7801\u5b66\u4e60 - \u51c6\u5907\u5de5\u4f5c","permalink":"/docs/coding/framework/vue/vue2-learn-prepare"}}');var o=i(74848),s=i(28453);const r={},c="vue2 \u521d\u59cb\u5316\u8fc7\u7a0b",d={},l=[{value:"\u5165\u53e3",id:"\u5165\u53e3",level:2},{value:"\u63a2\u79d8 <code>/src/instance/index.js</code>",id:"\u63a2\u79d8-srcinstanceindexjs",level:3},{value:"\u63a2\u79d8 <code>/src/core/instance/init.js</code>",id:"\u63a2\u79d8-srccoreinstanceinitjs",level:3},{value:"<code>initMixin</code>",id:"initmixin",level:4},{value:"<code>resolveConstructorOptions</code>",id:"resolveconstructoroptions",level:4},{value:"<code>resolveModifiedOptions</code>",id:"resolvemodifiedoptions",level:4},{value:"<code>mergeOptions</code>",id:"mergeoptions",level:4},{value:"<code>initInjections</code>",id:"initinjections",level:4},{value:"<code>resolveInject</code>",id:"resolveinject",level:4},{value:"<code>initProvide</code>",id:"initprovide",level:4},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function a(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"vue2-\u521d\u59cb\u5316\u8fc7\u7a0b",children:"vue2 \u521d\u59cb\u5316\u8fc7\u7a0b"})}),"\n",(0,o.jsxs)(e.p,{children:["\u6bcf\u4e2a Vue2 \u9879\u76ee\u7684\u5165\u53e3\u6587\u4ef6\u90fd\u6709 ",(0,o.jsx)(e.code,{children:"new Vue\uff08options\uff09"}),", \u8fd9\u91cc\u7684\u9b54\u6cd5\u4e00\u8d77\u6765\u63a2\u5bfb\u4e0b\u5427"]}),"\n",(0,o.jsx)(e.h2,{id:"\u5165\u53e3",children:"\u5165\u53e3"}),"\n",(0,o.jsxs)(e.h3,{id:"\u63a2\u79d8-srcinstanceindexjs",children:["\u63a2\u79d8 ",(0,o.jsx)(e.code,{children:"/src/instance/index.js"})]}),"\n",(0,o.jsxs)(e.p,{children:["\u5728 ",(0,o.jsx)(e.code,{children:"/example"})," \u76ee\u5f55\u4e0b\u65b0\u5efa\u4e00\u4e2a HTML \u6587\u4ef6\uff0c\u901a\u8fc7",(0,o.jsx)(e.strong,{children:"\u6253\u65ad\u70b9"}),"\u7684\u65b9\u5f0f\u6765\u5b66\u4e60"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-html",children:'<!DOCTYPE html>\n<html lang="en">\n  <head>\n    <meta charset="UTF-8" />\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n    <title>Document</title>\n  </head>\n  <body>\n    <div id="app">{{msg}}</div>\n    <script src="../dist/vue.js"><\/script>\n    <script>\n      debugger;\n      new Vue({\n        el: "#app",\n        data: {\n          msg: "hello Olu",\n        },\n      });\n    <\/script>\n  </body>\n</html>\n'})}),"\n",(0,o.jsxs)(e.p,{children:["\u901a\u8fc7\u65ad\u70b9 F11 \u8c03\u8bd5\u53ef\u4ee5\u77e5\u9053\u5165\u53e3\u5728 ",(0,o.jsx)(e.code,{children:"/src/instance/index.js"})," \u4e2d"]}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.img,{src:"https://fxpby.oss-cn-beijing.aliyuncs.com/blogImg/blogImg/vue2/new-vue-instance.png",alt:"new-vue-instance"})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:'import { initMixin } from "./init";\nimport { stateMixin } from "./state";\nimport { renderMixin } from "./render";\nimport { eventsMixin } from "./events";\nimport { lifecycleMixin } from "./lifecycle";\nimport { warn } from "../util/index";\n\n// Vue \u6784\u9020\u51fd\u6570\nfunction Vue(options) {\n  if (process.env.NODE_ENV !== "production" && !(this instanceof Vue)) {\n    warn("Vue is a constructor and should be called with the `new` keyword");\n  }\n  // \u8c03\u7528 Vue.prototype._init \u65b9\u6cd5\uff08\u5728 initMixin \u4e2d\u5b9a\u4e49\uff09\n  this._init(options);\n}\n\ninitMixin(Vue);\nstateMixin(Vue);\neventsMixin(Vue);\nlifecycleMixin(Vue);\nrenderMixin(Vue);\n\nexport default Vue;\n'})}),"\n",(0,o.jsxs)(e.h3,{id:"\u63a2\u79d8-srccoreinstanceinitjs",children:["\u63a2\u79d8 ",(0,o.jsx)(e.code,{children:"/src/core/instance/init.js"})]}),"\n",(0,o.jsxs)(e.p,{children:["\u4e0a\u9762\u77e5\u9053 ",(0,o.jsx)(e.code,{children:"_init"})," \u65b9\u6cd5\u5728 ",(0,o.jsx)(e.code,{children:"/src/core/instance/init.js"})," \u4e2d\uff0c\u6765\u5230\u8fd9\u91cc\u77a7\u4e00\u77a7"]}),"\n",(0,o.jsx)(e.h4,{id:"initmixin",children:(0,o.jsx)(e.code,{children:"initMixin"})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:'export function initMixin(Vue: Class<Component>) {\n  // Vue \u521d\u59cb\u5316\u8fc7\u7a0b\n  Vue.prototype._init = function (options?: Object) {\n    // vue \u5b9e\u4f8b\n    const vm: Component = this;\n    // a uid\uff0c\u6bcf\u4e2a vue \u5b9e\u4f8b\u90fd\u6709\u4e00\u4e2a _uid, \u4e14\u4f9d\u6b21\u9012\u589e\n    vm._uid = uid++;\n\n    let startTag, endTag;\n    /* istanbul ignore if */\n    if (process.env.NODE_ENV !== "production" && config.performance && mark) {\n      startTag = `vue-perf-start:${vm._uid}`;\n      endTag = `vue-perf-end:${vm._uid}`;\n      mark(startTag);\n    }\n\n    // a flag to avoid this being observed\n    vm._isVue = true;\n    // merge options \u5904\u7406\u7ec4\u4ef6\u914d\u7f6e\u9879\n    if (options && options._isComponent) {\n      // optimize internal component instantiation\n      // since dynamic options merging is pretty slow, and none of the\n      // internal component options needs special treatment.\n      /**\n       * \u6bcf\u4e2a\u5b50\u7ec4\u4ef6\u521d\u59cb\u5316\u65f6\u7684\u6027\u80fd\u4f18\u5316\u5904\u7406\n       * \u5c06\u7ec4\u4ef6\u914d\u7f6e\u5bf9\u8c61\u4e0a\u7684\u4e00\u4e9b\u6df1\u5c42\u6b21\u5c5e\u6027\u653e\u5230 vm.$options \u4e2d\n       */\n      initInternalComponent(vm, options);\n    } else {\n      /**\n       * \u521d\u59cb\u5316\u6839\u7ec4\u4ef6\uff0c \u5408\u5e76 Vue \u7684\u5168\u5c40\u914d\u7f6e\u5230\u6839\u7ec4\u4ef6\u7684\u5c40\u90e8\u914d\u7f6e\uff0c\u5982 Vue.component \u6ce8\u518c\u7684\u5168\u5c40\u7ec4\u4ef6\u4f1a\u5408\u5e76\u5230 \u6839\u5b9e\u4f8b \u7684 component \u9009\u9879\u4e2d\n       * \u6bcf\u4e2a\u5b50\u7ec4\u4ef6\u7684\u9009\u9879\u5408\u5e76\u5728\uff1a\n       *   1. Vue.component \u65b9\u6cd5\u6ce8\u518c\u7684\u5168\u5c40\u7ec4\u4ef6\u5728\u6ce8\u518c\u65f6\u505a\u4e86\u9009\u9879\u5408\u5e76\n       *   2. {component: {xx}} \u65b9\u5f0f\u6ce8\u518c\u7684\u5c40\u90e8\u7ec4\u4ef6\u5728\u6267\u884c\u7f16\u8bd1\u5668\u751f\u6210\u7684 render \u51fd\u6570\u65f6\u505a\u4e86\u9009\u9879\u5408\u5e76\uff0c\u5305\u62ec\u6839\u7ec4\u4ef6\n       */\n      vm.$options = mergeOptions(\n        resolveConstructorOptions(vm.constructor),\n        options || {},\n        vm\n      );\n    }\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV !== "production") {\n      // \u8bbe\u7f6e\u4ee3\u7406\uff0c\u5c06 vm \u5b9e\u4f8b\u4e0a\u7684\u5c5e\u6027\u4ee3\u7406\u5230 vm._renderProxy\n      initProxy(vm);\n    } else {\n      vm._renderProxy = vm;\n    }\n    // expose real self\n    vm._self = vm;\n\n    // \u521d\u59cb\u5316\u7ec4\u4ef6\u5b9e\u4f8b\u5173\u7cfb\u5c5e\u6027\uff0c\u5982 $parent\u3001$children\u3001$root\u3001$refs \u7b49\n    initLifecycle(vm);\n\n    /**\n     * \u521d\u59cb\u5316\u81ea\u5b9a\u4e49\u4e8b\u4ef6\uff0c <comp @click="handleClick" /> \u7c7b\u4f3c\u8fd9\u6837\u6ce8\u518c\u7684\u4e8b\u4ef6\uff0c\u76d1\u542c\u8005\u4e0d\u662f\u7236\u7ec4\u4ef6\u800c\u662f\u5b50\u7ec4\u4ef6\u672c\u8eab\uff0c\u4e8b\u4ef6\u7684\u6d3e\u53d1\u548c\u76d1\u542c\u8005\u90fd\u662f\u5b50\u7ec4\u4ef6\n     */\n    initEvents(vm);\n\n    /**\n     * \u89e3\u6790\u7ec4\u4ef6\u7684\u63d2\u69fd\u4fe1\u606f\uff0c\u5f97\u5230 vm.$slot, \u5904\u7406\u6e32\u67d3\u51fd\u6570\uff0c\u5f97\u5230 vm.$createElement \u65b9\u6cd5\uff0c\u5373 h \u51fd\u6570\n     */\n    initRender(vm);\n\n    // \u8c03\u7528 beforeCreate \u94a9\u5b50\u51fd\u6570\n    callHook(vm, "beforeCreate");\n\n    // \u521d\u59cb\u5316\u7ec4\u4ef6\u7684 inject \u914d\u7f6e\u9879\uff0c\u5f97\u5230 result[key] = val \u5f62\u5f0f\u7684\u914d\u7f6e\u5bf9\u8c61\uff0c\u8fdb\u800c\u5bf9\u7ed3\u679c\u6570\u636e\u8fdb\u884c\u54cd\u5e94\u5f0f\u5904\u7406\uff0c\u4ee3\u7406\u6bcf\u4e2a key \u5230 vm \u5b9e\u4f8b\n    initInjections(vm); // resolve injections before data/props\n\n    // \u6570\u636e\u54cd\u5e94\u5f0f\uff0c\u5904\u7406 props\u3001methods\u3001data\u3001computed\u3001watch\n    initState(vm);\n\n    // \u89e3\u6790\u7ec4\u4ef6\u914d\u7f6e\u4e0a\u7684 provide \u5bf9\u8c61\uff0c\u6302\u8f7d\u5230 vm._provided \u5c5e\u6027\u4e0a\n    initProvide(vm); // resolve provide after data/props\n\n    // \u8c03\u7528 created \u94a9\u5b50\n    callHook(vm, "created");\n\n    /* istanbul ignore if */\n    if (process.env.NODE_ENV !== "production" && config.performance && mark) {\n      vm._name = formatComponentName(vm, false);\n      mark(endTag);\n      measure(`vue ${vm._name} init`, startTag, endTag);\n    }\n\n    // \u5982\u679c\u914d\u7f6e\u9879\u4e2d\u6709 el \u9009\u9879\uff0c\u5219\u81ea\u52a8\u8c03\u7528 $mount \u65b9\u6cd5\uff0c\u5373\u6709\u4e86 el \u9009\u9879\uff0c\u5c31\u4e0d\u9700\u8981\u518d\u624b\u52a8\u8c03\u7528 $mount\n    if (vm.$options.el) {\n      // \u8c03\u7528 $mount, \u8fdb\u5165\u6302\u8f7d\u9636\u6bb5\n      vm.$mount(vm.$options.el);\n    }\n  };\n}\n'})}),"\n",(0,o.jsx)(e.h4,{id:"resolveconstructoroptions",children:(0,o.jsx)(e.code,{children:"resolveConstructorOptions"})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:"export function resolveConstructorOptions(Ctor: Class<Component>) {\n  // \u914d\u7f6e\u9879\u76ee\n  let options = Ctor.options;\n  if (Ctor.super) {\n    // \u5b58\u5728\u57fa\u7c7b\uff0c\u9012\u5f52\u89e3\u6790\u57fa\u7c7b\u6784\u9020\u51fd\u6570\u9009\u9879\n    const superOptions = resolveConstructorOptions(Ctor.super);\n    const cachedSuperOptions = Ctor.superOptions;\n    if (superOptions !== cachedSuperOptions) {\n      // super option changed,\n      // need to resolve new options.\n      // \u57fa\u7c7b\u6784\u9020\u51fd\u6570\u9009\u9879\u6539\u53d8\uff0c\u9700\u8981\u91cd\u65b0\u8bbe\u7f6e\n      Ctor.superOptions = superOptions;\n      // check if there are any late-modified/attached options (#4976)\n      // \u68c0\u67e5 Ctor.options \u662f\u5426\u6709\u4efb\u4f55\u540e\u671f\u4fee\u6539\u6216\u9644\u52a0\u7684\u9009\u9879\n      const modifiedOptions = resolveModifiedOptions(Ctor);\n      // update base extend options\n      // \u5982\u679c\u6709\u5219\u5408\u5e76\n      if (modifiedOptions) {\n        extend(Ctor.extendOptions, modifiedOptions);\n      }\n      // \u9009\u9879\u5408\u5e76\uff0c\u5c06\u5408\u5e76\u7ed3\u679c\u8d4b\u503c\u4e3a Ctor.options\n      options = Ctor.options = mergeOptions(superOptions, Ctor.extendOptions);\n      if (options.name) {\n        options.components[options.name] = Ctor;\n      }\n    }\n  }\n  return options;\n}\n"})}),"\n",(0,o.jsx)(e.h4,{id:"resolvemodifiedoptions",children:(0,o.jsx)(e.code,{children:"resolveModifiedOptions"})}),"\n",(0,o.jsx)(e.p,{children:"\u89e3\u6790\u6784\u9020\u51fd\u6570\u9009\u9879\u4e2d\u540e\u7eed\u88ab\u4fee\u6539\u6216\u8005\u589e\u52a0\u7684\u9009\u9879"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:"function resolveModifiedOptions(Ctor: Class<Component>): ?Object {\n  let modified;\n  // \u6784\u9020\u51fd\u6570\u9009\u9879\n  const latest = Ctor.options;\n  // \u5bc6\u5c01\u7684\u6784\u9020\u51fd\u6570\u9009\u9879\uff0c\u7528\u4e8e\u5907\u4efd\n  const sealed = Ctor.sealedOptions;\n  // \u5bf9\u6bd4\u4e24\u4e2a\u9009\u9879\uff0c\u8bb0\u5f55\u4e0d\u4e00\u6837\u7684\n  for (const key in latest) {\n    if (latest[key] !== sealed[key]) {\n      if (!modified) modified = {};\n      modified[key] = latest[key];\n    }\n  }\n  return modified;\n}\n"})}),"\n",(0,o.jsx)(e.h4,{id:"mergeoptions",children:(0,o.jsx)(e.code,{children:"mergeOptions"})}),"\n",(0,o.jsxs)(e.p,{children:["\u4f4d\u4e8e ",(0,o.jsx)(e.code,{children:"/src/core/util/options.js"})]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:'// \u5408\u5e76\u4e24\u4e2a\u9009\u9879\uff0c\u51fa\u73b0\u76f8\u540c\u914d\u7f6e\u9879\u65f6\uff0c\u5b50\u9009\u9879\u4f1a\u8986\u76d6\u7236\u9009\u9879\u7684\u914d\u7f6e\u9879\nexport function mergeOptions(\n  parent: Object,\n  child: Object,\n  vm?: Component\n): Object {\n  if (process.env.NODE_ENV !== "production") {\n    checkComponents(child);\n  }\n\n  if (typeof child === "function") {\n    child = child.options;\n  }\n\n  // \u6807\u51c6\u5316 props\uff0cinject,directive \u9009\u9879\uff0c\u65b9\u4fbf\u540e\u7eed\u7a0b\u5e8f\u5904\u7406\n  normalizeProps(child, vm);\n  normalizeInject(child, vm);\n  normalizeDirectives(child);\n\n  // Apply extends and mixins on the child options,\n  // but only if it is a raw options object that isn\'t\n  // the result of another mergeOptions call.\n  // Only merged options has the _base property.\n\n  // \u5904\u7406\u539f\u59cb child \u5bf9\u8c61\u4e0a\u7684 extends \u548c mixins, \u5206\u522b\u6267\u884c mergeOptions, \u5c06\u8fd9\u4e9b\u7ee7\u627f\u800c\u6765\u7684\u9009\u9879\u5408\u5e76\u5230 parent\n  // mergeOptions \u5904\u7406\u8fc7\u7684\u5bf9\u8c61\u4f1a\u542b\u6709 _base \u5c5e\u6027\n  if (!child._base) {\n    if (child.extends) {\n      parent = mergeOptions(parent, child.extends, vm);\n    }\n    if (child.mixins) {\n      for (let i = 0, l = child.mixins.length; i < l; i++) {\n        parent = mergeOptions(parent, child.mixins[i], vm);\n      }\n    }\n  }\n\n  const options = {};\n  let key;\n\n  // \u904d\u5386\u7236\u9009\u9879\n  for (key in parent) {\n    mergeField(key);\n  }\n\n  // \u904d\u5386\u5b50\u9009\u9879\uff0c\u5982\u679c\u7236\u9009\u9879\u4e0d\u5b58\u5728\u8be5\u914d\u7f6e\u9879\u5219\u5408\u5e76\uff0c\u5426\u5219\u8df3\u8fc7\uff0c\u56e0\u4e3a\u7236\u5b50\u62e5\u6709\u540c\u4e00\u5c5e\u6027\u7684\u60c5\u51b5\u5728\u4e0a\u9762\u5904\u7406\u7236\u9009\u9879\u65f6\u5df2\u7ecf\u5904\u7406\u8fc7\uff0c\u4f7f\u7528\u5b50\u9009\u9879\u7684\u503c\n  for (key in child) {\n    if (!hasOwn(parent, key)) {\n      mergeField(key);\n    }\n  }\n\n  // \u5408\u5e76\u9009\u9879\uff0cchildVal \u4f18\u5148\u7ea7\u9ad8\u4e8e parentVal\n  function mergeField(key) {\n    const strat = strats[key] || defaultStrat;\n\n    // \u503c\u4e3a\u5982\u679c childVal \u5b58\u5728\u5219\u4f18\u5148\u4f7f\u7528 childVal\uff0c\u5426\u5219\u4f7f\u7528 parentVal\n    options[key] = strat(parent[key], child[key], vm, key);\n  }\n  return options;\n}\n'})}),"\n",(0,o.jsx)(e.h4,{id:"initinjections",children:(0,o.jsx)(e.code,{children:"initInjections"})}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.code,{children:"/src/core/instance/inject.js"})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:'/**\n * \u521d\u59cb\u5316 inject \u914d\u7f6e\u9879\n * 1. \u5f97\u5230 result[key] = val\n * 2. \u5bf9\u7ed3\u679c\u6570\u636e\u8fdb\u884c\u54cd\u5e94\u5f0f\u5904\u7406\uff0c\u4ee3\u7406\u6bcf\u4e2a key \u5230 vm \u5b9e\u4f8b\n */\nexport function initInjections(vm: Component) {\n  // \u89e3\u6790 inject \u914d\u7f6e\u9879\uff0c\u7136\u540e\u4ece\u7956\u4ee3\u7ec4\u4ef6\u7684\u914d\u7f6e\u4e2d\u627e\u5230\u914d\u7f6e\u9879\u4e2d\u6bcf\u4e00\u4e2a key \u5bf9\u5e94\u7684 val\uff0c\u6700\u540e\u5f97\u5230 result[key] = val \u7684\u7ed3\u679c\n  const result = resolveInject(vm.$options.inject, vm);\n  // \u5bf9 result \u505a\u6570\u636e\u54cd\u5e94\u5f0f\u5904\u7406\uff0c\u4e5f\u6709\u4ee3\u7406 inject \u914d\u7f6e\u4e2d\u6bcf\u4e2a key \u5230 vm \u5b9e\u4f8b\u7684\u4f5c\u7528\n  // \u4e0d\u5efa\u8bae\u5728\u5b50\u7ec4\u4ef6\u66f4\u6539\u6570\u636e\uff0c\u56e0\u4e3a\u4e00\u65e6\u7956\u4ee3\u7ec4\u4ef6\u4e2d\u6ce8\u5165\u7684 provide \u53d1\u751f\u66f4\u6539\uff0c\u7ec4\u4ef6\u4e2d\u505a\u7684\u66f4\u6539\u5c31\u4f1a\u88ab\u8986\u76d6\n  if (result) {\n    toggleObserving(false);\n    Object.keys(result).forEach((key) => {\n      /* istanbul ignore else */\n      if (process.env.NODE_ENV !== "production") {\n        defineReactive(vm, key, result[key], () => {\n          warn(\n            `Avoid mutating an injected value directly since the changes will be ` +\n              `overwritten whenever the provided component re-renders. ` +\n              `injection being mutated: "${key}"`,\n            vm\n          );\n        });\n      } else {\n        defineReactive(vm, key, result[key]);\n      }\n    });\n    toggleObserving(true);\n  }\n}\n'})}),"\n",(0,o.jsx)(e.h4,{id:"resolveinject",children:(0,o.jsx)(e.code,{children:"resolveInject"})}),"\n",(0,o.jsxs)(e.p,{children:["\u4f4d\u4e8e ",(0,o.jsx)(e.code,{children:"/src/core/instance/inject.js"})]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:'/**\n * \u89e3\u6790 inject \u914d\u7f6e\u9879\uff0c\u4ece\u7956\u4ee3\u7ec4\u4ef6\u7684 provide \u914d\u7f6e\u4e2d\u627e\u5230 key \u503c\uff0c\u5426\u5219\u7528\u9ed8\u8ba4\u503c\uff0c\u6700\u540e\u5f97\u5230 result[key] = val\n * inject \u5bf9\u8c61\u5f97\u5230\u7684\u7ed3\u6784\u5982\u4e0b\uff08\u5408\u5e76\u9009\u9879\u65f6\u5bf9\u7ec4\u4ef6\u914d\u7f6e\u5bf9\u8c61\u505a\u4e86\u6807\u51c6\u5316\u5904\u7406\uff09\n * inject = {\n *   key: {\n *     from: provideKey,\n *     default: xxx\n *   }\n * }\n */\nexport function resolveInject(inject: any, vm: Component): ?Object {\n  if (inject) {\n    // inject is :any because flow is not smart enough to figure out cached\n    const result = Object.create(null);\n\n    // inject \u914d\u7f6e\u9879\u7684\u6240\u6709 key\n    const keys = hasSymbol ? Reflect.ownKeys(inject) : Object.keys(inject);\n\n    // \u904d\u5386 key\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i];\n      // #6574 in case the inject object is observed...\n      // \u8df3\u8fc7 __ob__ \u5bf9\u8c61\n      if (key === "__ob__") continue;\n      // \u5f97\u5230 provide \u4e2d\u5bf9\u5e94\u7684 key\n      const provideKey = inject[key].from;\n      let source = vm;\n      // \u904d\u5386\u6240\u6709\u7684\u7956\u4ee3\u7ec4\u4ef6\uff0c\u76f4\u81f3\u6839\u7ec4\u4ef6\uff0c\u627e\u5230 provide \u4e2d\u5bf9\u5e94 key \u7684\u503c\uff0c\u6700\u540e\u5f97\u5230 result[key] = provide[provideKey]\n      while (source) {\n        if (source._provided && hasOwn(source._provided, provideKey)) {\n          result[key] = source._provided[provideKey];\n          break;\n        }\n        source = source.$parent;\n      }\n\n      // \u5982\u679c\u4e0a\u9762 while \u5faa\u73af\u672a\u627e\u5230\uff0c\u4f7f\u7528 inject[key].default, \u5982\u679c\u6ca1\u6709\u8bbe\u7f6e default\uff0c\u5219\u629b\u51fa\u9519\u8bef\n      if (!source) {\n        if ("default" in inject[key]) {\n          const provideDefault = inject[key].default;\n          result[key] =\n            typeof provideDefault === "function"\n              ? provideDefault.call(vm)\n              : provideDefault;\n        } else if (process.env.NODE_ENV !== "production") {\n          warn(`Injection "${key}" not found`, vm);\n        }\n      }\n    }\n    return result;\n  }\n}\n'})}),"\n",(0,o.jsx)(e.h4,{id:"initprovide",children:(0,o.jsx)(e.code,{children:"initProvide"})}),"\n",(0,o.jsxs)(e.p,{children:["\u4f4d\u4e8e",(0,o.jsx)(e.code,{children:"/src/core/instance/inject.js"})]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:'// \u89e3\u6790\u7ec4\u4ef6\u914d\u7f6e\u9879\u4e0a\u7684 provide \u5bf9\u8c61\uff0c\u5c06\u5176\u6302\u8f7d\u5230 vm._provided \u5c5e\u6027\u4e0a\nexport function initProvide(vm: Component) {\n  const provide = vm.$options.provide;\n  if (provide) {\n    vm._provided = typeof provide === "function" ? provide.call(vm) : provide;\n  }\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,o.jsx)(e.p,{children:"new Vue \u8fc7\u7a0b\uff1a"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:["\u5904\u7406\u7ec4\u4ef6\u914d\u7f6e\u9879","\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"\u521d\u59cb\u5316\u6839\u7ec4\u4ef6\u65f6\u8fdb\u884c\u4e86\u9009\u9879\u5408\u5e76\uff0c\u5c06\u5168\u5c40\u914d\u7f6e\u5408\u5e76\u5230\u6839\u7ec4\u4ef6\u7684\u5c40\u90e8\u914d\u7f6e\u4e0a"}),"\n",(0,o.jsx)(e.li,{children:"\u521d\u59cb\u5316\u6bcf\u4e2a\u5b50\u7ec4\u4ef6\u65f6\u505a\u4e86\u4e00\u4e9b\u6027\u80fd\u4f18\u5316\uff0c\u5c06\u7ec4\u4ef6\u914d\u7f6e\u5bf9\u8c61\u4e0a\u7684\u6df1\u5c42\u6b21\u5c5e\u6027\u653e\u5230 vm.$options \u9009\u9879\u4e2d\uff0c\u63d0\u9ad8\u4ee3\u7801\u6267\u884c\u6548\u7387"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(e.li,{children:"\u521d\u59cb\u5316\u7ec4\u4ef6\u5b9e\u4f8b\u7684\u5173\u7cfb\u5c5e\u6027\uff0c\u5982 $parent,$children,$root,$refs \u7b49"}),"\n",(0,o.jsx)(e.li,{children:"\u5904\u7406\u81ea\u5b9a\u4e49\u4e8b\u4ef6"}),"\n",(0,o.jsx)(e.li,{children:"\u8c03\u7528 beforeCreate \u94a9\u5b50\u51fd\u6570"}),"\n",(0,o.jsxs)(e.li,{children:["\u521d\u59cb\u5316\u7ec4\u4ef6\u7684 inject \u914d\u7f6e\u9879\uff0c\u5f97\u5230 ",(0,o.jsx)(e.code,{children:"ret[key] = val"})," \u5f62\u5f0f\u7684\u914d\u7f6e\u5bf9\u8c61\u3002\u7136\u540e\u5bf9\u8be5\u914d\u7f6e\u5bf9\u8c61\u8fdb\u884c\u6d45\u5c42\u54cd\u5e94\u5f0f\u5904\u7406\uff08\u53ea\u5904\u7406\u4e86\u5bf9\u8c61\u7684\u7b2c\u4e00\u6b21\u6570\u636e\uff09\uff0c\u5e76\u4ee3\u7406\u6bcf\u4e2a key \u5230 vm \u5b9e\u4f8b\u4e0a"]}),"\n",(0,o.jsx)(e.li,{children:"\u6570\u636e\u54cd\u5e94\u5f0f\uff0c\u5904\u7406 props\uff0cmethods\uff0cdata\uff0ccomputed\uff0cwatch \u7b49\u9009\u9879"}),"\n",(0,o.jsx)(e.li,{children:"\u89e3\u6790\u7ec4\u4ef6\u914d\u7f6e\u9879\u4e0a\u7684 provide \u5bf9\u8c61\uff0c\u6302\u8f7d\u5230 vm._provide \u4e0a"}),"\n",(0,o.jsx)(e.li,{children:"\u8c03\u7528 created \u94a9\u5b50\u51fd\u6570"}),"\n",(0,o.jsx)(e.li,{children:"\u5982\u679c\u53d1\u73b0\u914d\u7f6e\u9879\u4e0a\u6709 el \u9009\u9879\uff0c\u5219\u81ea\u52a8\u8c03\u7528 $mount \u65b9\u6cd5\uff1b\u82e5\u6ca1\u6709\u9700\u8981\u624b\u52a8\u8c03\u7528 $mount \u65b9\u6cd5"}),"\n",(0,o.jsx)(e.li,{children:"\u8fdb\u5165\u6302\u8f7d\u9636\u6bb5"}),"\n"]})]})}function p(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(a,{...n})}):a(n)}},28453:(n,e,i)=>{i.d(e,{R:()=>r,x:()=>c});var t=i(96540);const o={},s=t.createContext(o);function r(n){const e=t.useContext(s);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:r(n.components),t.createElement(s.Provider,{value:e},n.children)}}}]);