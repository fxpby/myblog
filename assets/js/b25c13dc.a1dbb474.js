"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1016],{3905:(e,n,t)=>{t.d(n,{Zo:()=>s,kt:()=>u});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var p=r.createContext({}),d=function(e){var n=r.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},s=function(e){var n=d(e.components);return r.createElement(p.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},c=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,p=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),c=d(t),u=o,k=c["".concat(p,".").concat(u)]||c[u]||m[u]||a;return t?r.createElement(k,l(l({ref:n},s),{},{components:t})):r.createElement(k,l({ref:n},s))}));function u(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,l=new Array(a);l[0]=c;var i={};for(var p in n)hasOwnProperty.call(n,p)&&(i[p]=n[p]);i.originalType=e,i.mdxType="string"==typeof e?e:o,l[1]=i;for(var d=2;d<a;d++)l[d]=t[d];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}c.displayName="MDXCreateElement"},6591:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>l,default:()=>m,frontMatter:()=>a,metadata:()=>i,toc:()=>d});var r=t(7462),o=(t(7294),t(3905));const a={id:"react-re-renders",title:"React \u91cd\u65b0\u6e32\u67d3(re-render)",tags:["react","re-render"]},l=void 0,i={unversionedId:"react/react-re-renders",id:"react/react-re-renders",title:"React \u91cd\u65b0\u6e32\u67d3(re-render)",description:"\ud83c\udf701. React \u7684 re-render \u662f\u4ec0\u4e48",source:"@site/docs/react/react-re-renders.md",sourceDirName:"react",slug:"/react/react-re-renders",permalink:"/myblog/docs/react/react-re-renders",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/react/react-re-renders.md",tags:[{label:"react",permalink:"/myblog/docs/tags/react"},{label:"re-render",permalink:"/myblog/docs/tags/re-render"}],version:"current",frontMatter:{id:"react-re-renders",title:"React \u91cd\u65b0\u6e32\u67d3(re-render)",tags:["react","re-render"]},sidebar:"React"},p={},d=[{value:"\ud83c\udf701. React \u7684 <code>re-render</code> \u662f\u4ec0\u4e48",id:"1-react-\u7684-re-render-\u662f\u4ec0\u4e48",level:2},{value:"\ud83c\udf402. \u5fc5\u8981\u7684 <code>re-render</code> \u548c \u4e0d\u5fc5\u8981\u7684 <code>re-render</code>",id:"2-\u5fc5\u8981\u7684-re-render-\u548c-\u4e0d\u5fc5\u8981\u7684-re-render",level:2},{value:"\ud83c\udf432.1 \u5fc5\u8981\u7684 <code>re-render</code>",id:"21-\u5fc5\u8981\u7684-re-render",level:3},{value:"\ud83c\udf422.2 \u4e0d\u5fc5\u8981\u7684 <code>re-render</code>",id:"22-\u4e0d\u5fc5\u8981\u7684-re-render",level:3},{value:"\ud83d\udd5b3. <code>re-render</code> \u65f6\u673a",id:"3-re-render-\u65f6\u673a",level:2},{value:"\ud83d\udcad3.1 <code>state</code> \u6539\u53d8",id:"31-state-\u6539\u53d8",level:3},{value:"\ud83d\udcad3.2 parent <code>re-render</code>",id:"32-parent-re-render",level:3},{value:"\ud83d\udcad3.3 <code>context</code> \u6539\u53d8",id:"33-context-\u6539\u53d8",level:3},{value:"\ud83d\udcad3.4 <code>hooks</code> \u6539\u53d8",id:"34-hooks-\u6539\u53d8",level:3},{value:"\ud83d\udcac 3.5 <code>props</code> \u6539\u53d8",id:"-35-props-\u6539\u53d8",level:3},{value:"\ud83d\ude914. \u89c4\u907f <code>re-render</code> \u7684\u65b9\u5f0f",id:"4-\u89c4\u907f-re-render-\u7684\u65b9\u5f0f",level:2},{value:"\ud83c\udf1f4.1 \u5de7\u5999\u5229\u7528\u7ec4\u5408",id:"41-\u5de7\u5999\u5229\u7528\u7ec4\u5408",level:3},{value:"\u26d44.1.1 \u907f\u514d\u5728 <code>render function</code> \u4e2d\u521b\u5efa\u7ec4\u4ef6",id:"411-\u907f\u514d\u5728-render-function-\u4e2d\u521b\u5efa\u7ec4\u4ef6",level:4},{value:"\u27054.1.2 \u5411\u4e0b\u79fb\u52a8 <code>state</code>",id:"412-\u5411\u4e0b\u79fb\u52a8-state",level:4},{value:"\u27054.1.3 <code>children</code> as <code>props</code>",id:"413-children-as-props",level:4},{value:"\u27054.1.4 <code>components</code> as <code>props</code>",id:"414-components-as-props",level:4},{value:"\ud83d\udef44.2 \u4f7f\u7528 <code>React.memo</code>",id:"42-\u4f7f\u7528-reactmemo",level:3},{value:"\u27054.2.1 <code>React.memo</code> + <code>component with props</code>",id:"421-reactmemo--component-with-props",level:4},{value:"\u27054.2.2 <code>React.memo</code> + <code>components as props or children</code>",id:"422-reactmemo--components-as-props-or-children",level:4},{value:"\ud83d\ude974.3 \u4f7f\u7528 <code>useMemo</code>/<code>useCallback</code> \u63d0\u9ad8\u6027\u80fd",id:"43-\u4f7f\u7528-usememousecallback-\u63d0\u9ad8\u6027\u80fd",level:3},{value:"\u26d44.3.1 \u53cd\u6a21\u5f0f\uff1a\u5728 <code>props</code> \u4e2d\u4f7f\u7528\u975e\u5fc5\u8981\u7684 <code>useMemo</code>/<code>useCallback</code>",id:"431-\u53cd\u6a21\u5f0f\u5728-props-\u4e2d\u4f7f\u7528\u975e\u5fc5\u8981\u7684-usememousecallback",level:4},{value:"\u27054.3.2 \u5fc5\u8981\u7684\u4f7f\u7528 <code>useMemo</code>/<code>useCallback</code>",id:"432-\u5fc5\u8981\u7684\u4f7f\u7528-usememousecallback",level:4},{value:"\u27054.3.3 \u4f7f\u7528 <code>useMemo</code> \u8fdb\u884c\u590d\u6742\u7684\u8ba1\u7b97",id:"433-\u4f7f\u7528-usememo-\u8fdb\u884c\u590d\u6742\u7684\u8ba1\u7b97",level:4},{value:"\ud83d\ude845. \u63d0\u9ad8\u5217\u8868\u7684 <code>re-render</code> \u6027\u80fd",id:"5-\u63d0\u9ad8\u5217\u8868\u7684-re-render-\u6027\u80fd",level:2},{value:"\u26d45.1 \u53cd\u6a21\u5f0f\uff1a\u4f7f\u7528\u968f\u673a\u6570\u4f5c\u4e3a\u5217\u8868\u7684 key",id:"51-\u53cd\u6a21\u5f0f\u4f7f\u7528\u968f\u673a\u6570\u4f5c\u4e3a\u5217\u8868\u7684-key",level:3}],s={toc:d};function m(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,r.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"1-react-\u7684-re-render-\u662f\u4ec0\u4e48"},"\ud83c\udf701. React \u7684 ",(0,o.kt)("inlineCode",{parentName:"h2"},"re-render")," \u662f\u4ec0\u4e48"),(0,o.kt)("p",null,"\u63a2\u8ba8 React \u6027\u80fd\u95ee\u9898\u65f6\uff0c\u4e00\u822c\u4e3b\u8981\u5173\u6ce8\u4e24\u4e2a\u5185\u5bb9"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"initial render"),"\uff08\u521d\u59cb\u6e32\u67d3\uff09\uff0c\u5373\u7ec4\u4ef6\u9996\u6b21\u51fa\u73b0\u5728\u5c4f\u5e55\u4e0a"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"re-render"),"(\u91cd\u65b0\u6e32\u67d3)\uff0c\u5373\u5bf9\u5df2\u51fa\u73b0\u5728\u5c4f\u5e55\u4e0a\u7684\u7ec4\u4ef6\u8fdb\u884c\u7b2c\u4e8c\u6b21\u6216\u8005\u4efb\u4f55\u8fde\u7eed\u7684\u6e32\u67d3")),(0,o.kt)("p",null,"\u5f53 React \u9700\u8981\u4f7f\u7528\u65b0\u7684\u6570\u636e\u53bb\u66f4\u65b0\u5e94\u7528\u7a0b\u5e8f\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u53d1\u751f ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render"),". \u901a\u5e38\u662f\u7531\u4e8e\u7528\u6237\u4e0e\u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u4ea4\u4e92\uff0c\u6216\u901a\u8fc7\u5f02\u6b65\u8bf7\u6c42\u6216\u67d0\u79cd\u8ba2\u9605\u6a21\u578b\u83b7\u53d6\u67d0\u4e9b\u5916\u90e8\u6570\u636e"),(0,o.kt)("p",null,"\u6ca1\u6709\u5f02\u6b65\u6570\u636e\u66f4\u65b0\u6216\u8005\u975e\u4ea4\u4e92\u5f0f\u5e94\u7528\u7a0b\u5e8f\u6c38\u8fdc\u4e0d\u4f1a\u53d1\u751f ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render")),(0,o.kt)("h2",{id:"2-\u5fc5\u8981\u7684-re-render-\u548c-\u4e0d\u5fc5\u8981\u7684-re-render"},"\ud83c\udf402. \u5fc5\u8981\u7684 ",(0,o.kt)("inlineCode",{parentName:"h2"},"re-render")," \u548c \u4e0d\u5fc5\u8981\u7684 ",(0,o.kt)("inlineCode",{parentName:"h2"},"re-render")),(0,o.kt)("h3",{id:"21-\u5fc5\u8981\u7684-re-render"},"\ud83c\udf432.1 \u5fc5\u8981\u7684 ",(0,o.kt)("inlineCode",{parentName:"h3"},"re-render")),(0,o.kt)("p",null,"\u91cd\u65b0\u6e32\u67d3\u66f4\u6539\u6e90\u7ec4\u4ef6\u6216\u4e00\u4e2a\u7ec4\u4ef6\u76f4\u63a5\u4f7f\u7528\u65b0\u7684\u4fe1\u606f\u3002\u5982\u7528\u6237\u5728 input \u8f93\u5165\u6846\u4e2d\u8f93\u5165\u6570\u636e\uff0c\u7ba1\u7406\u72b6\u6001\u7684\u7ec4\u4ef6\u9700\u8981\u5728\u6bcf\u6b21\u6309\u952e\u65f6\u66f4\u65b0"),(0,o.kt)("h3",{id:"22-\u4e0d\u5fc5\u8981\u7684-re-render"},"\ud83c\udf422.2 \u4e0d\u5fc5\u8981\u7684 ",(0,o.kt)("inlineCode",{parentName:"h3"},"re-render")),(0,o.kt)("p",null,"\u7531\u4e8e\u9519\u8bef\u6216\u4f4e\u6548\u7684\u5e94\u7528\u7a0b\u5e8f\u67b6\u6784\uff0c\u901a\u8fc7\u4e0d\u540c\u7684\u6e32\u67d3\u673a\u5236\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u4f20\u9012\u7684\u7ec4\u4ef6\u7684\u91cd\u65b0\u6e32\u67d3\u3002\u5982\u7528\u6237\u952e\u5165 input \u8f93\u5165\u6846\u7684\u573a\u666f\uff0c",(0,o.kt)("strong",{parentName:"p"},"\u6574\u4e2a\u9875\u9762"),"\u5728\u7528\u6237\u53d1\u751f\u6309\u952e\u52a8\u4f5c\u65f6\u90fd\u4f1a\u91cd\u65b0\u6e32\u67d3\uff0c\u8fd9\u91cc\u6574\u4e2a\u9875\u9762\u5c31\u662f\u4e0d\u5fc5\u8981\u7684\u91cd\u65b0\u6e32\u67d3"),(0,o.kt)("p",null,"\u5c3d\u7ba1 React \u7684\u901f\u5ea6\u5f88\u5feb\uff0c\u901a\u5e38\u53ef\u4ee5\u5728\u7528\u6237\u65e0\u77e5\u89c9\u7684\u72b6\u51b5\u4e0b\u5904\u7406\uff0c\u4f46\u662f\u5982\u679c\u91cd\u65b0\u6e32\u67d3\u53d1\u751f\u5f97\u8fc7\u4e8e\u9891\u7e41\u6216\u8005\u53d1\u751f\u5728\u975e\u5e38\u91cd\u7684\u7ec4\u4ef6\u4e0a\uff0c\u5c31\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7528\u6237\u4f53\u9a8c\u6ede\u540e\uff0c\u5373\u4ea4\u4e92\u5ef6\u8fdf\u6216\u8005\u5e94\u7528\u7a0b\u5e8f\u6ca1\u6709\u53cd\u5e94"),(0,o.kt)("h2",{id:"3-re-render-\u65f6\u673a"},"\ud83d\udd5b3. ",(0,o.kt)("inlineCode",{parentName:"h2"},"re-render")," \u65f6\u673a"),(0,o.kt)("p",null,"\u7ec4\u4ef6 ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render")," \u7684\u56db\u4e2a\u573a\u666f"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"state")," \u6539\u53d8"),(0,o.kt)("li",{parentName:"ul"},"\u7236/\u5b50\u7ec4\u4ef6 ",(0,o.kt)("inlineCode",{parentName:"li"},"re-render")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"context")," \u6539\u53d8"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"hooks")," \u6539\u53d8")),(0,o.kt)("p",null,"\u8fd8\u6709\u4e00\u4e2a\u662f\u7ec4\u4ef6\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"props")," \u53d8\u5316"),(0,o.kt)("h3",{id:"31-state-\u6539\u53d8"},"\ud83d\udcad3.1 ",(0,o.kt)("inlineCode",{parentName:"h3"},"state")," \u6539\u53d8"),(0,o.kt)("p",null,"\u7ec4\u4ef6 ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," \u53d1\u751f\u53d8\u5316\u65f6\uff0c\u4f1a ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render"),". \u901a\u5e38\u4f1a\u53d1\u751f\u5728 ",(0,o.kt)("inlineCode",{parentName:"p"},"callback")," \u6216 ",(0,o.kt)("inlineCode",{parentName:"p"},"useEffect")," hook"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"state")," \u6539\u53d8\u662f\u6240\u6709 ",(0,o.kt)("inlineCode",{parentName:"strong"},"re-render")," \u7684\u6839\u6e90")),(0,o.kt)("h3",{id:"32-parent-re-render"},"\ud83d\udcad3.2 parent ",(0,o.kt)("inlineCode",{parentName:"h3"},"re-render")),(0,o.kt)("p",null,"\u5982\u679c\u4e00\u4e2a\u7ec4\u4ef6\u7684\u7236\u7ec4\u4ef6\u91cd\u65b0\u6e32\u67d3\uff0c\u8be5\u7ec4\u4ef6\u4e5f\u4f1a\u91cd\u65b0\u6e32\u67d3\u3002\u5373\u4e00\u4e2a\u7ec4\u4ef6\u91cd\u65b0\u6e32\u67d3\u65f6\uff0c\u4e5f\u4f1a\u91cd\u65b0\u6e32\u67d3\u5b83\u7684\u6240\u6709\u5b50\u7ec4\u4ef6"),(0,o.kt)("p",null,"\u5927\u591a\u6570\u60c5\u51b5\u662f\u6cbf\u7740\u6811",(0,o.kt)("strong",{parentName:"p"},"\u5411\u4e0b"),"\u6e32\u67d3\uff0c\u5373\u5b50\u7ec4\u4ef6\u7684\u91cd\u65b0\u6e32\u67d3\u4e0d\u4f1a\u89e6\u53d1\u7236\u7ec4\u4ef6\u91cd\u65b0\u6e32\u67d3"),(0,o.kt)("h3",{id:"33-context-\u6539\u53d8"},"\ud83d\udcad3.3 ",(0,o.kt)("inlineCode",{parentName:"h3"},"context")," \u6539\u53d8"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"context provider")," \u503c\u53d8\u5316\u65f6\uff0c",(0,o.kt)("strong",{parentName:"p"},"\u6240\u6709"),"\u4f7f\u7528\u8fd9\u4e2a ",(0,o.kt)("inlineCode",{parentName:"p"},"context")," \u7ec4\u4ef6\u90fd\u4f1a ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render"),"\uff0c\u5373\u4f7f\u4ed6\u4eec\u6ca1\u6709\u76f4\u63a5\u4f7f\u7528\u6570\u636e\u7684\u53d8\u5316\u90e8\u5206"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"// 1. value changes\nconst useValue = useContext(Context)\n\n// 2. re-render\nconst Component = () => {\n  const value = useValue()\n}\n")),(0,o.kt)("p",null,"\u5e76\u4e14\u8fd9\u90e8\u5206\u91cd\u65b0\u6e32\u67d3\u65e0\u6cd5\u76f4\u63a5\u901a\u8fc7\u7f13\u5b58\u6765\u9632\u6b62\uff0c\u4f46\u662f\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u9ad8\u9636\u7ec4\u4ef6\u548c ",(0,o.kt)("inlineCode",{parentName:"p"},"React.memo")," \u6765\u4f2a\u9020\u4e0a\u4e0b\u6587\u9009\u62e9\u5668"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"useMemo")," \u65e0\u6548\u4f8b\u5b50"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const useSomething = () => {\n  // 1. \u4f1a\u89e6\u53d1 re-render \u5373\u4f7f something \u4e0d\u6539\u53d8\n  const {something} = useContext(Context)\n\n  // 2. useMemo \u4e0d\u4f1a\u8d77\u4f5c\u7528\n  return useMemo(() => something, [something])\n}\n\nconst Component = () => {\n  // 3. \u4f1a re-render \u5373\u4f7f something \u4e0d\u6539\u53d8\n  const {something} = useSomething()\n  return ...\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"HOC")," + ",(0,o.kt)("inlineCode",{parentName:"p"},"React.memo")," \u4f2a\u9020\u4e0a\u4e0b\u6587\u9009\u62e9\u5668"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const withSomething = (Component) => {\n  // 1. \u7ec4\u4ef6\u88ab\u7f13\u5b58\n  const MemoComponent = React.memo(Component)\n\n  return () => {\n    const { something } = useSomething()\n\n    // 2. \u53ea\u6709\u5728 something \u6539\u53d8\u65f6\u624d\u4f1a re-render\n    return <MemoComponent something={something} />\n  }\n}\n\n// 3. \u53ea\u6709\u5728 something \u6539\u53d8\u65f6\u624d\u4f1a re-render\nconst Component = withSomething(({something}) => {\n  return ...\n})\n")),(0,o.kt)("h3",{id:"34-hooks-\u6539\u53d8"},"\ud83d\udcad3.4 ",(0,o.kt)("inlineCode",{parentName:"h3"},"hooks")," \u6539\u53d8"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"hook")," \u4e2d\u53d1\u751f\u7684\u6240\u6709\u4e8b\u60c5\u90fd\u5c5e\u4e8e\u4f7f\u7528\u5b83\u7684\u7ec4\u4ef6\uff0c\u540c\u6837\u9002\u7528\u4e8e ",(0,o.kt)("inlineCode",{parentName:"p"},"context")," \u548c ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," \u6539\u53d8\u7684\u89c4\u5219"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"hook")," \u5185 ",(0,o.kt)("inlineCode",{parentName:"li"},"state")," \u7684\u6539\u53d8\u4f1a\u89e6\u53d1\u5bbf\u4e3b\u7ec4\u4ef6\u4e0d\u53ef\u9884\u9632\u7684 ",(0,o.kt)("inlineCode",{parentName:"li"},"re-render")),(0,o.kt)("li",{parentName:"ul"},"\u5982\u679c ",(0,o.kt)("inlineCode",{parentName:"li"},"hook")," \u4f7f\u7528\u4e86 ",(0,o.kt)("inlineCode",{parentName:"li"},"context"),"\uff0c\u5e76\u4e14 ",(0,o.kt)("inlineCode",{parentName:"li"},"context")," \u7684\u503c\u6539\u53d8\uff0c\u5c31\u4f1a\u89e6\u53d1\u5bbf\u4e3b\u7ec4\u4ef6\u4e0d\u53ef\u9884\u9632\u7684 ",(0,o.kt)("inlineCode",{parentName:"li"},"re-render"))),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"hook")," \u53ef\u4ee5\u88ab\u94fe\u5f0f\u4f7f\u7528\uff0c\u94fe\u6761\u4e2d\u6bcf\u4e00\u4e2a ",(0,o.kt)("inlineCode",{parentName:"p"},"hook")," \u4ecd\u5c5e\u4e8e\u5bbf\u4e3b\u7ec4\u4ef6\uff0c\u5e76\u4e14\u540c\u6837\u7684\u89c4\u5219\u9002\u7528\u4e8e\u4efb\u4f55\u4e00\u4e2a ",(0,o.kt)("inlineCode",{parentName:"p"},"hook")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"// 1. value \u6539\u53d8\nconst useSomething = useContext(Context)\n\n// 2. chain reaction\nconst useValue = {\n  useSomething()\n}\n\n// -----------------------\n// 3. re-renders\nconst Component = () => {\n  const value = useValue()\n  return ...\n}\n")),(0,o.kt)("h3",{id:"-35-props-\u6539\u53d8"},"\ud83d\udcac 3.5 ",(0,o.kt)("inlineCode",{parentName:"h3"},"props")," \u6539\u53d8"),(0,o.kt)("p",null,"\u5728 ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render")," \u975e\u7f13\u5b58\u7ec4\u4ef6\u65f6\uff0c\u7ec4\u4ef6\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"props")," \u662f\u5426\u6539\u53d8\u5e76\u4e0d\u91cd\u8981"),(0,o.kt)("p",null,"\u4e3a\u4e86\u6539\u53d8 ",(0,o.kt)("inlineCode",{parentName:"p"},"props"),"\uff0c\u9700\u8981\u901a\u8fc7\u7236\u7ec4\u4ef6\u5bf9\u5176\u8fdb\u884c\u66f4\u65b0\u3002\u8fd9\u610f\u5473\u7740\u7236\u7ec4\u4ef6\u9700\u8981 ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render"),"\uff0c\u8fd9\u4f1a\u89e6\u53d1\u5b50\u7ec4\u4ef6\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render"),"\uff0c\u4e0d\u7ba1 ",(0,o.kt)("inlineCode",{parentName:"p"},"props")," \u662f\u4ec0\u4e48"),(0,o.kt)("p",null,"\u53ea\u6709\u5728\u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"React.memo")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"useMemo")," \u65f6\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"props")," \u6539\u53d8\u624d\u91cd\u8981"),(0,o.kt)("h2",{id:"4-\u89c4\u907f-re-render-\u7684\u65b9\u5f0f"},"\ud83d\ude914. \u89c4\u907f ",(0,o.kt)("inlineCode",{parentName:"h2"},"re-render")," \u7684\u65b9\u5f0f"),(0,o.kt)("h3",{id:"41-\u5de7\u5999\u5229\u7528\u7ec4\u5408"},"\ud83c\udf1f4.1 \u5de7\u5999\u5229\u7528\u7ec4\u5408"),(0,o.kt)("h4",{id:"411-\u907f\u514d\u5728-render-function-\u4e2d\u521b\u5efa\u7ec4\u4ef6"},"\u26d44.1.1 \u907f\u514d\u5728 ",(0,o.kt)("inlineCode",{parentName:"h4"},"render function")," \u4e2d\u521b\u5efa\u7ec4\u4ef6"),(0,o.kt)("p",null,"\u5728\u53e6\u4e00\u4e2a\u7ec4\u4ef6\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"render function")," \u4e2d\u521b\u5efa\u7ec4\u4ef6\u662f\u4e00\u79cd\u53cd\u6a21\u5f0f\uff0c\u8fd9\u53ef\u80fd\u662f\u6700\u5927\u7684\u6027\u80fd\u6740\u624b"),(0,o.kt)("p",null,"\u6bcf\u6b21 ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render")," react \u4f1a ",(0,o.kt)("inlineCode",{parentName:"p"},"re-mount")," \u8be5\u7ec4\u4ef6\uff08\u5373 ",(0,o.kt)("inlineCode",{parentName:"p"},"destroy")," \u9500\u6bc1\u5b83\u5e76\u4ece\u5934\u5f00\u59cb ",(0,o.kt)("inlineCode",{parentName:"p"},"re-create")," \u91cd\u65b0\u521b\u5efa\uff09\uff0c\u8fd9\u4f1a\u6bd4\u6b63\u5e38\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render")," \u6162\u66f4\u591a\uff0c\u9664\u6b64\u4e4b\u5916\u8fd8\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u95ee\u9898\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"re-render")," \u65f6\u5185\u5bb9\u53ef\u80fd\u95ea\u70c1"),(0,o.kt)("li",{parentName:"ul"},"\u6bcf\u6b21 ",(0,o.kt)("inlineCode",{parentName:"li"},"re-render")," \u90fd\u4f1a\u5728\u7ec4\u4ef6\u4e2d ",(0,o.kt)("inlineCode",{parentName:"li"},"reset")," \u91cd\u7f6e ",(0,o.kt)("inlineCode",{parentName:"li"},"state")),(0,o.kt)("li",{parentName:"ul"},"\u6bcf\u6b21 ",(0,o.kt)("inlineCode",{parentName:"li"},"re-render")," \u90fd\u89e6\u53d1\u65e0\u4f9d\u8d56\u7684 ",(0,o.kt)("inlineCode",{parentName:"li"},"useEffect")),(0,o.kt)("li",{parentName:"ul"},"\u5982\u679c\u67d0\u4e2a\u7ec4\u4ef6\u5df2\u7ecf ",(0,o.kt)("inlineCode",{parentName:"li"},"focused"),"\uff0c",(0,o.kt)("inlineCode",{parentName:"li"},"focus")," \u5c06\u4f1a\u5931\u53bb")),(0,o.kt)("p",null,"\u53cd\u6a21\u5f0f\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'// 1. re-render\nconst Component = () => {\n  // 2. new component\n  const SlowComponent = () => {\n  console.log("slow component re-renders");\n  useEffect(() => {\n    console.log("slow component re-mounts");\n  }, []);\n  return <div>slow component</div>;\n};\n\n  return (\n    // 3. re-mount\n    <SlowComponent/>\n  )\n}\n')),(0,o.kt)("p",null,"\u653e\u5230 ",(0,o.kt)("inlineCode",{parentName:"p"},"render function")," \u5916"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'// 2. same component\nconst SlowComponent = () => {\n  console.log("slow component re-renders");\n  useEffect(() => {\n    console.log("slow component re-mounts");\n  }, []);\n  return <div>slow component</div>;\n};\n\n// 1. re-render\nconst Component = () => {\n  return (\n    // 3. \u4ec5 re-render\uff0c\u4e0d\u89e6\u53d1\u65e0\u4f9d\u8d56\u7684 useEffect\n    <SlowComponent/>\n  )\n}\n')),(0,o.kt)("h4",{id:"412-\u5411\u4e0b\u79fb\u52a8-state"},"\u27054.1.2 \u5411\u4e0b\u79fb\u52a8 ",(0,o.kt)("inlineCode",{parentName:"h4"},"state")),(0,o.kt)("p",null,"\u5f53\u4e00\u4e2a\u91cd\u578b\u7ec4\u4ef6\u9700\u8981\u7ba1\u7406 ",(0,o.kt)("inlineCode",{parentName:"p"},"state"),"\uff0c\u5e76\u4e14 ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," \u53ea\u7528\u4e8e ",(0,o.kt)("inlineCode",{parentName:"p"},"render tree")," \u7684\u4e00\u5c0f\u90e8\u5206\u65f6\uff0c\u8fd9\u4e2a\u65b9\u5f0f\u4f1a\u5f88\u68d2"),(0,o.kt)("p",null,"\u5178\u578b\u573a\u666f\u5c31\u662f\u5728\u4e00\u4e2a\u590d\u6742\u7684\u7ec4\u4ef6\u4e2d\u901a\u8fc7\u70b9\u51fb\u6309\u94ae\u6253\u5f00/\u5173\u95ed\u5bf9\u8bdd\u6846\uff0c\u800c\u6539\u7ec4\u4ef6\u4f1a\u6e32\u67d3\u9875\u9762\u5927\u90e8\u5206\u5185\u5bb9"),(0,o.kt)("p",null,"\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u63a7\u5236\u5bf9\u8bdd\u6846\u663e\u9690\u72b6\u6001\u3001\u5bf9\u8bdd\u6846\u672c\u8eab\u548c\u89e6\u53d1\u66f4\u65b0\u7684\u6309\u94ae\u90fd\u53ef\u4ee5\u5c01\u88c5\u5728\u4e00\u4e2a",(0,o.kt)("strong",{parentName:"p"},"\u8f83\u5c0f\u7684\u7ec4\u4ef6"),"\u4e2d\u3002\u8fd9\u6837\u8f83\u5927\u7684\u7ec4\u4ef6\u4e0d\u4f1a\u5728\u8fd9\u4e9b ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," \u53d1\u751f\u53d8\u5316\u65f6 ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="\u4e0d\u62c6\u5206\uff0c\u5168\u91cf"',title:'"\u4e0d\u62c6\u5206\uff0c\u5168\u91cf"'},"const SlowComponent = () => {\n  console.log('slow component re-renders')\n  return <>slow component</>\n}\n\nconst FullComponent = () => {\n  const [isShow, setIsShow] = useState(false)\n  const handleClick = () => {\n    // 1. state change\uff0c\u89e6\u53d1 re-render\n    setIsShow(!isShow)\n  }\n  return (\n    <div>\n      <button onClick={() => handleClick()}>click here</button>\n      {isShow && <div>dialog</div>}\n      {/* 2. re-render */}\n      <SlowComponent />\n    </div>\n  );\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="\u62c6\u5206\u540e"',title:'"\u62c6\u5206\u540e"'},"const SlowComponent = () => {\n  console.log('slow component re-renders')\n  return <>slow component</>\n}\n\nconst ComponentWithButton = () => {\n  const [isShow, setIsShow] = useState(false)\n  const handleClick = () => {\n    // 1. state change\uff0c\u89e6\u53d1 re-render\n    setIsShow(!isShow)\n  }\n  return (\n    <div>\n      <button onClick={() => handleClick()}>click here</button>\n      {isShow && <div>dialog</div>}\n    </div>\n      \n  )\n}\n\nconst SplitComponent = () => {\n  return (\n    <div>\n      <ComponentWithButton/>\n      {/* 2. \u4e0d\u53d7\u5f71\u54cd */}\n      <SlowComponent />\n    </div>\n  );\n}\n")),(0,o.kt)("h4",{id:"413-children-as-props"},"\u27054.1.3 ",(0,o.kt)("inlineCode",{parentName:"h4"},"children")," as ",(0,o.kt)("inlineCode",{parentName:"h4"},"props")),(0,o.kt)("p",null,"\u8fd9\u79cd\u6a21\u5f0f\u548c\u524d\u9762\u7684\u201c\u5411\u4e0b\u79fb\u52a8\u201d\u7c7b\u4f3c\uff0c\u90a3\u79cd\u5c06 ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," \u5305\u88f9\u5728 ",(0,o.kt)("inlineCode",{parentName:"p"},"children")," \u5468\u56f4\u7684\u611f\u89c9\uff0c\u5373\u5c06 ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," \u53d8\u5316\u5c01\u88c5\u5728\u4e00\u4e2a\u8f83\u5c0f\u7684\u7ec4\u4ef6\u4e2d"),(0,o.kt)("p",null,"\u533a\u522b\u662f ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," \u7528\u5728\u4e00\u4e2a\u5143\u7d20\u4e0a\uff0c\u8be5\u5143\u7d20\u5305\u88f9\u4e86 ",(0,o.kt)("inlineCode",{parentName:"p"},"render tree")," \u7684\u4e00\u4e2a\u8f83\u6162\u7684\u90e8\u5206\uff0c\u6240\u6709\u65e0\u6cd5\u8f7b\u677e\u63d0\u53d6"),(0,o.kt)("p",null,"\u8f83\u591a\u7684\u4f7f\u7528\u573a\u666f\u662f ",(0,o.kt)("inlineCode",{parentName:"p"},"onScroll")," \u6216 ",(0,o.kt)("inlineCode",{parentName:"p"},"onMouseMove")," \u7684 \u56de\u8c03 ",(0,o.kt)("inlineCode",{parentName:"p"},"callbacks")," \u9644\u52a0\u5230\u7ec4\u4ef6\u7684\u6839\u5143\u7d20\u4e0a"),(0,o.kt)("p",null,"\u8fd9\u79cd\u60c5\u51b5 ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," \u7ba1\u7406\u548c\u4f7f\u7528\u76f8\u5173 ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," \u7684\u7ec4\u4ef6\u63d0\u53d6\u5230\u4e00\u4e2a\u5c0f\u7ec4\u4ef6\u4e2d\uff0c\u5e76\u5c06\u6162\u7ec4\u4ef6\u4f5c\u4e3a ",(0,o.kt)("inlineCode",{parentName:"p"},"children")," \u4f20\u9012\u7ed9\u5b83\u3002\u4ece\u8f83\u5c0f\u7ec4\u4ef6\u7684\u89d2\u5ea6\u770b\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"children")," \u53ea\u662f ",(0,o.kt)("inlineCode",{parentName:"p"},"prop"),"\uff0c\u4e0d\u4f1a\u6536\u5230 ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," \u6539\u53d8\u7684\u5f71\u54cd\uff0c\u6545\u4e0d\u4f1a ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="\u4e0d\u62c6\u5206\uff0c\u5168\u91cf"',title:'"\u4e0d\u62c6\u5206\uff0c\u5168\u91cf"'},'const SlowComponent = () => {\n  console.log("slow component re-renders")\n  return <div>slow component</div>\n}\n\nconst FullComponent = () => {\n  const [state, setState] = useState(0)\n\n  const handleClick = () => {\n    // 1. \u89e6\u53d1 re-render\n    setState(state + 1)\n  }\n\n  return (\n    <div onClick={() => handleClick()}>\n      <div>Re-render count: {state}</div>\n      {/* 2. re-render */}\n      <SlowComponent />\n    </div>\n  )\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="\u62c6\u5206\u540e"',title:'"\u62c6\u5206\u540e"'},'const SlowComponent = () => {\n  console.log("slow component re-renders")\n  return <div>slow component</div>\n}\n\nconst ComponentWithClick = ({children}) => {\n  const [state, setState] = useState(0)\n\n  const handleClick = () => {\n    // 1. \u89e6\u53d1 re-render\n    setState(state + 1)\n  }\n\n  return (\n    <div onClick={() => handleClick()}>\n      <div>Re-render count: {state}</div>\n      {/* 2. props\uff0c\u4e0d\u53d7\u5f71\u54cd */}\n      {children}\n    </div>\n  )\n}\n\nconst SplitComponent = () => {\n  return (\n    <ComponentWithClick>\n      {/* 3. \u4e0d\u53d7\u5f71\u54cd */}\n      <SlowComponent/>\n    </ComponentWithClick>\n  )\n}\n')),(0,o.kt)("h4",{id:"414-components-as-props"},"\u27054.1.4 ",(0,o.kt)("inlineCode",{parentName:"h4"},"components")," as ",(0,o.kt)("inlineCode",{parentName:"h4"},"props")),(0,o.kt)("p",null,"\u548c\u4e4b\u524d\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"children")," \u4f5c\u4e3a ",(0,o.kt)("inlineCode",{parentName:"p"},"props")," \u7c7b\u4f3c\uff0c\u5c06 ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," \u5c01\u88c5\u5728\u4e00\u4e2a\u8f83\u5c0f\u7684\u7ec4\u4ef6\u5185\uff0c\u91cd\u578b\u7ec4\u4ef6\u4f5c\u4e3a ",(0,o.kt)("inlineCode",{parentName:"p"},"props")," \u4f20\u9012\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"props")," \u4e0d\u53d7 ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," \u6539\u53d8\u7684\u5f71\u54cd\uff0c\u6545\u91cd\u578b\u7ec4\u4ef6\u4e0d\u4f1a ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render")),(0,o.kt)("p",null,"\u5f53\u4e00\u4e9b\u91cd\u578b\u7ec4\u4ef6\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," \u72ec\u7acb\uff0c\u4f46\u662f\u65e0\u6cd5\u4f5c\u4e3a ",(0,o.kt)("inlineCode",{parentName:"p"},"children")," \u63d0\u53d6\u51fa\u6765\u65f6\uff0c\u8fd9\u79cd\u65b9\u6cd5\u5c31\u5f88\u68d2"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="\u4e0d\u62c6\u5206\uff0c\u5168\u91cf"',title:'"\u4e0d\u62c6\u5206\uff0c\u5168\u91cf"'},'const SlowComponent = () => {\n  console.log("slow component re-renders")\n  return <div>slow component</div>\n}\n\nconst AnotherSlowComponent = () => {\n  console.log("another slow component re-renders")\n  return <div>another slow component</div>\n}\n\nconst FullComponent = () => {\n  const [state, setState] = useState(0)\n  const handleClick = () => {\n    // 1. \u89e6\u53d1 re-render\n    setState(state + 1)\n  }\n\n  return (\n    <div>\n      <div>Re-render count: {state} </div>\n      {/* 2. re-render */}\n      <SlowComponent/>\n      {/* 2. re-render */}\n      <AnotherSlowComponent/>\n    </div>\n  )\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="\u62c6\u5206\u540e"',title:'"\u62c6\u5206\u540e"'},'const SlowComponent = () => {\n  console.log("slow component re-renders")\n  return <div>slow component</div>\n}\n\nconst AnotherSlowComponent = () => {\n  console.log("another slow component re-renders")\n  return <div>another slow component</div>\n}\n\nconst ComponentWithClick = (left, right) => {\n  const [state, setState] = useState(0)\n  const handleClick = () => {\n    // 1. \u89e6\u53d1 re-render\n    setState(state + 1)\n  }\n\n  return (\n    <div>\n      <div>Re-render count: {state} </div>\n      {/* 2. \u4f5c\u4e3a props \u4e0d\u53d7\u5f71\u54cd */}\n      {left}\n      {/* 2. \u4f5c\u4e3a props \u4e0d\u53d7\u5f71\u54cd */}\n      {right}\n    </div>\n  )\n}\n\nconst SplitComponent = () => {\n  const left = <SlowComponent/>\n  const right = <AnotherSlowComponent/>\n\n  return (\n    <>\n      <ComponentWithClick left={left} right={right}/>\n    </>\n  )\n}\n')),(0,o.kt)("h3",{id:"42-\u4f7f\u7528-reactmemo"},"\ud83d\udef44.2 \u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"h3"},"React.memo")),(0,o.kt)("p",null,"\u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"React.memo")," \u5305\u88f9\u7ec4\u4ef6\u53ef\u4ee5\u505c\u6b62\u5728 ",(0,o.kt)("inlineCode",{parentName:"p"},"render tree")," \u7684\u67d0\u5904\u89e6\u53d1\u4e0b\u6e38\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render")," \u94fe\u6761\uff0c\u9664\u975e\u7ec4\u4ef6\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"props")," \u6539\u53d8"),(0,o.kt)("p",null,"\u5728\u6e32\u67d3\u4e0d\u4f9d\u8d56 ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render")," \u6e90\u5934\uff08",(0,o.kt)("inlineCode",{parentName:"p"},"state")," \u6539\u53d8\uff09\u7684\u91cd\u578b\u7ec4\u4ef6\u7684\u573a\u666f\u8fd9\u4e2a\u65b9\u6cd5\u5f88\u68d2"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'const Child = () => {\n  console.log("child re-render")\n  return <>child</>\n}\n\nconst ChildMemo = React.memo(Child)\n\nconst Component = () => {\n  const [state, setState] = useState(0)\n\n  const handleClick = () => {\n    setState(state + 1)\n  }\n\n  return (\n    <>\n      <button onClick={() => handleClick()}>click here, state: {state}</button>\n      <ChildMemo/>\n    </>\n  )\n}\n')),(0,o.kt)("h4",{id:"421-reactmemo--component-with-props"},"\u27054.2.1 ",(0,o.kt)("inlineCode",{parentName:"h4"},"React.memo")," + ",(0,o.kt)("inlineCode",{parentName:"h4"},"component with props")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u6240\u6709\u7684\u975e\u57fa\u7840\u7c7b\u578b\uff08\u5f15\u7528\u7c7b\u578b\uff09\u7684 ",(0,o.kt)("inlineCode",{parentName:"strong"},"props"))," \u90fd\u5fc5\u987b\u8fdb\u884c\u7f13\u5b58\uff08",(0,o.kt)("inlineCode",{parentName:"p"},"useMemo"),"\uff09\uff0c\u8fd9\u6837 ",(0,o.kt)("inlineCode",{parentName:"p"},"React.memo")," \u624d\u80fd\u5de5\u4f5c"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const Child = ({value}) => {\n  console.log('Child re-render ', value.value)\n  return <>{value.value}</>\n}\n\nconst ChildMemo = React.memo(Child)\n\nconst Component = () => {\n  const [state, setState] = useState(0)\n\n  const handleClick = () => {\n    // 1. \u89e6\u53d1 re-render\n    setState(state + 1)\n  }\n\n  const memoValue = useMemo(() => ({value: 'second'}), [])\n\n  return (\n    <>\n      <button onClick={()=>handleClick()}>click here, state: {state}</button>\n      {/* 2. value changes, re-render */}\n      <ChildMemo value={{value: 'first'}}/>\n      {/* 2. memoValue \u6ca1\u53d8, \u4e0d\u4f1a re-render */}\n      <ChildMemo value={memoValue}/>\n    </>\n  )\n}\n")),(0,o.kt)("h4",{id:"422-reactmemo--components-as-props-or-children"},"\u27054.2.2 ",(0,o.kt)("inlineCode",{parentName:"h4"},"React.memo")," + ",(0,o.kt)("inlineCode",{parentName:"h4"},"components as props or children")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"React.memo")," \u5fc5\u987b\u5e94\u7528\u4e8e\u4f5c\u4e3a ",(0,o.kt)("inlineCode",{parentName:"p"},"children")," \u6216 ",(0,o.kt)("inlineCode",{parentName:"p"},"props")," \u7684\u5143\u7d20"),(0,o.kt)("p",null,"\u5f53 ",(0,o.kt)("inlineCode",{parentName:"p"},"children")," \u548c ",(0,o.kt)("inlineCode",{parentName:"p"},"props")," \u90fd\u662f ",(0,o.kt)("inlineCode",{parentName:"p"},"object")," \u65f6\uff0c\u6bcf\u6b21 ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render")," \u90fd\u4f1a\u6539\u53d8\uff0c\u7f13\u5b58\u7684\u7236\u7ec4\u4ef6\u5c06\u4f1a\u4e0d\u8d77\u4f5c\u7528"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="Memoized children or props of not memoized parent should not"',title:'"Memoized',children:!0,or:!0,props:!0,of:!0,not:!0,memoized:!0,parent:!0,should:!0,'not"':!0},'const Child = ({value}) => {\n  console.log("Child re-render ", value.value)\n  return <>{value.value}</>\n}\n\nconst ChildMemo = React.memo(Child)\n\nconst Parent = ({left, children}) => {\n  return (\n    <div>\n      {left}\n      {children}\n    </div>\n  )\n}\n\nconst ParentMemo = React.memo(Parent)\n\nconst Component = () => {\n  const [state, setState] = useState(0)\n\n  const handleClick = () => {\n    // 1. \u89e6\u53d1 re-render\n    setState(state + 1)\n  }\n\n  const memoValue = useMemo(() => ({value: "memoized"}), [])\n\n  return (\n    <>\n      <button onClick={() => handleClick()}>click here,state: {state}</button>\n      {/* re-render */}\n      <ParentMemo left={<child value={{value: "left child of ParentMemo"}} />}>\n        <Child value={{value: "child of ParentMemo"}}/>\n      </ParentMemo>\n\n      {/* re-render */}\n      <ParentMemo left={<ChildMemo value={{value: "left ChildMemo of ParentMemo without memoValue"}} />}>\n        <ChildMemo value={{value: "ChildMemo of ParentMemo without memoValue"}}/>\n      </ParentMemo>\n      \n      {/* doesn\'t re-render */}\n      <Parent left={<ChildMemo value={memoValue} />}>\n        <ChildMemo value={memoValue}/>\n      </Parent>\n    </>\n  )\n}\n')),(0,o.kt)("h3",{id:"43-\u4f7f\u7528-usememousecallback-\u63d0\u9ad8\u6027\u80fd"},"\ud83d\ude974.3 \u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"h3"},"useMemo"),"/",(0,o.kt)("inlineCode",{parentName:"h3"},"useCallback")," \u63d0\u9ad8\u6027\u80fd"),(0,o.kt)("h4",{id:"431-\u53cd\u6a21\u5f0f\u5728-props-\u4e2d\u4f7f\u7528\u975e\u5fc5\u8981\u7684-usememousecallback"},"\u26d44.3.1 \u53cd\u6a21\u5f0f\uff1a\u5728 ",(0,o.kt)("inlineCode",{parentName:"h4"},"props")," \u4e2d\u4f7f\u7528\u975e\u5fc5\u8981\u7684 ",(0,o.kt)("inlineCode",{parentName:"h4"},"useMemo"),"/",(0,o.kt)("inlineCode",{parentName:"h4"},"useCallback")),(0,o.kt)("p",null,"\u7f13\u5b58 ",(0,o.kt)("inlineCode",{parentName:"p"},"props")," \u672c\u8eab\u4e0d\u4f1a\u963b\u6b62\u5b50\u7ec4\u4ef6 ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render"),"\uff0c\u5982\u679c\u4e00\u4e2a\u7236\u7ec4\u4ef6 ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render"),"\uff0c\u65e0\u8bba ",(0,o.kt)("inlineCode",{parentName:"p"},"props")," \u600e\u4e48\u6837\u90fd\u4f1a\u89e6\u53d1\u5b83\u5b50\u7ec4\u4ef6\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'const Child = ({value}) => {\n  console.log("child re-render", value.value)\n  return <>{value.value}</>\n}\n\nconst Component = () => {\n  const [state, setState] = useState(0)\n\n  const handleClick = () => {\n    // 1. \u89e6\u53d1 re-render\n    setState(state + 1)\n  }\n\n  const memoValue = useMemo(() => ({value: "child"}), [])\n\n  return (\n    <>\n      <button onClick={()=>handleClick()}>click here, state:{state}</button>\n      {/* 2. re-render */}\n      <Child value={memoValue} />\n    </>\n  )\n}\n')),(0,o.kt)("h4",{id:"432-\u5fc5\u8981\u7684\u4f7f\u7528-usememousecallback"},"\u27054.3.2 \u5fc5\u8981\u7684\u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"h4"},"useMemo"),"/",(0,o.kt)("inlineCode",{parentName:"h4"},"useCallback")),(0,o.kt)("p",null,"\u5982\u679c\u5b50\u7ec4\u4ef6\u88ab ",(0,o.kt)("inlineCode",{parentName:"p"},"React.memo")," \u5305\u88f9\uff0c\u5219",(0,o.kt)("strong",{parentName:"p"},"\u6240\u6709"),"\u975e\u57fa\u7840\u7c7b\u578b\uff08\u5f15\u7528\u7c7b\u578b\uff09\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"props")," \u90fd\u5fc5\u987b\u88ab\u7f13\u5b58"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const Child = ({value}) => {\n  console.log('Child re-render ', value.value)\n  return <>{value.value}</>\n}\n\nconst ChildMemo = React.memo(Child)\n\nconst Component = () => {\n  const [state, setState] = useState(0)\n\n  const handleClick = () => {\n    // 1. \u89e6\u53d1 re-render\n    setState(state + 1)\n  }\n\n  const memoValue = useMemo(() => ({value: 'second'}), [])\n\n  return (\n    <>\n      <button onClick={()=>handleClick()}>click here, state: {state}</button>\n      {/* 2. value changes, re-render */}\n      <ChildMemo value={{value: 'first'}}/>\n      {/* 2. memoValue \u6ca1\u53d8, \u4e0d\u4f1a re-render */}\n      <ChildMemo value={memoValue}/>\n    </>\n  )\n}\n")),(0,o.kt)("p",null,"\u5982\u679c\u7ec4\u4ef6\u5728 ",(0,o.kt)("inlineCode",{parentName:"p"},"useEffect"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"useMemo"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"useCallback")," \u7b49 ",(0,o.kt)("inlineCode",{parentName:"p"},"hook")," \u4e2d\u4f7f\u7528\u975e\u57fa\u7840\u7c7b\u578b\u503c\u4f5c\u4e3a\u4f9d\u8d56\uff0c\u4e5f\u5e94\u8be5\u88ab\u7f13\u5b58"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'const component = () => {\n  const [state, setState] = useState(0)\n\n  const handleClick = () => {\n    // 1. \u89e6\u53d1 re-render\n    setState(state + 1)\n  }\n\n  const value = {value: "not memoized"}\n\n  const memoValue = useMemo(() => ({ value: "memoized" }))\n\n  // \u9664\u9996\u6b21\u6e32\u67d3\u5176\u4ed6\u4e0d\u89e6\u53d1\n  useEffect(() => {\n    console.log("never triggered")\n  }, [memoValue])\n\n  // \u6bcf\u6b21\u91cd\u65b0\u6e32\u67d3\u90fd\u89e6\u53d1\n  useEffect(() => {\n    console.log("triggered on every re-render")\n  }, [value])\n\n  return (\n    <button onClick={() => handleClick()}>click here</button>\n  )\n}\n')),(0,o.kt)("h4",{id:"433-\u4f7f\u7528-usememo-\u8fdb\u884c\u590d\u6742\u7684\u8ba1\u7b97"},"\u27054.3.3 \u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"h4"},"useMemo")," \u8fdb\u884c\u590d\u6742\u7684\u8ba1\u7b97"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"useMemo")," \u7684\u4e00\u4e2a\u7528\u5904\u662f\u907f\u514d\u6bcf\u6b21 ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render")," \u662f\u8fdb\u884c\u590d\u6742\u7684\u8ba1\u7b97"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"useMemo")," \u5b58\u5728\u6027\u80fd\u8017\u8d39\u95ee\u9898\uff08\u6d88\u8017\u90e8\u5206\u5185\u5b58\uff0c\u8ba9\u521d\u6b21\u6e32\u67d3\u53d8\u6162\uff09\uff0c\u4e0d\u80fd\u6ee5\u7528\u3002\u5728 React \u4e2d\uff0c\u6302\u8f7d\u548c\u66f4\u65b0\u7ec4\u4ef6\u662f\u6700\u6602\u8d35\u590d\u6742\u7684\u8ba1\u7b97"),(0,o.kt)("p",null,"\u6240\u4ee5\uff0c\u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"useMemo")," \u7684\u5178\u578b\u573a\u666f\u662f\u7f13\u5b58 React \u5143\u7d20\uff0c\u901a\u5e38\u662f\u5df2\u7ecf\u5b58\u5728\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"render tree")," \u7684\u4e00\u90e8\u5206\u6216\u751f\u6210 ",(0,o.kt)("inlineCode",{parentName:"p"},"render tree")," \u7684\u7ed3\u679c\uff0c\u5982\u8fd4\u56de\u65b0\u5143\u7d20\u7684 map \u51fd\u6570"),(0,o.kt)("p",null,"\u540c\u7ec4\u4ef6\u66f4\u65b0\u76f8\u6bd4\uff0c\u6392\u5e8f\u6216\u8fc7\u6ee4\u6570\u7ec4\u8fd9\u79cd\u7eaf JavaScript \u64cd\u4f5c\u7684\u6210\u672c\u53ef\u4ee5\u5ffd\u7565\u4e0d\u8ba1"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'const Child = ({value}) => {\n  console.log("child re-render", value.value)\n  return <>{value.value}</>\n}\n\nconst values = [1,2,3]\nconst values2 = [4,5,6]\n\n\nconst Component = () => {\n  const [state, setState] = useState(0)\n\n  const handleClick = () => {\n    // 1. \u89e6\u53d1 re-render\n    setState(state + 1)\n  }\n\n  const items = useMemo(() => {\n    return values.map((v,i) => <Child key={i} value={{v}} />)\n  }, [])\n\n  const items2 = values2.map((v,i) => <Child key={i} value={{v}} />\n\n  return (\n    <>\n      <button> click here {state} </button>\n      {items}\n      <br/>\n      {items2}\n    </>\n  )\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'const SlowComponent = () => {\n  console.log("slow component re-renders");\n  return <div>slow component</div>;\n};\n\nconst component = () => {\n  const [state, setState] = useState(1);\n\n  const onClick = () => {\n    setState(state + 1);\n  };\n\n  const slowComponent = useMemo(() => {\n    return <SlowComponent />;\n  }, []);\n\n  return (\n    <>\n      <button onClick={onClick}>click here {state}</button>\n      <br />\n      {/* \u4e0d\u4f1a re-render */}\n      {slowComponent}\n    </>\n  )\n}\n')),(0,o.kt)("h2",{id:"5-\u63d0\u9ad8\u5217\u8868\u7684-re-render-\u6027\u80fd"},"\ud83d\ude845. \u63d0\u9ad8\u5217\u8868\u7684 ",(0,o.kt)("inlineCode",{parentName:"h2"},"re-render")," \u6027\u80fd"),(0,o.kt)("p",null,"\u9664\u4e86\u4e0a\u9762\u90a3\u4e9b\u548c ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render")," \u76f8\u5173\u7684\u89c4\u5219\u6a21\u5f0f\u5916\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"key")," \u5c5e\u6027\u4e5f\u4f1a\u5f71\u54cd ",(0,o.kt)("inlineCode",{parentName:"p"},"React")," \u5217\u8868\u4e2d\u7684\u6027\u80fd"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u4ec5\u63d0\u4f9b ",(0,o.kt)("inlineCode",{parentName:"strong"},"key")," \u5c5e\u6027\u5e76\u4e0d\u80fd\u63d0\u9ad8\u5217\u8868\u7684\u6027\u80fd\uff0c\u4e3a\u4e86\u9632\u6b62\u5217\u8868\u5143\u7d20 ",(0,o.kt)("inlineCode",{parentName:"strong"},"re-render"),"\uff0c\u9700\u8981\u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"strong"},"React.memo")," \u5bf9\u5176\u8fdb\u884c\u5c01\u88c5\uff0c\u5e76\u9075\u5b88\u6240\u6709\u7684\u6700\u4f73\u5b9e\u8df5"),"\ud83d\ude06"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"key")," \u4e2d\u7684\u503c\u9700\u8981\u662f",(0,o.kt)("strong",{parentName:"p"},"\u5b57\u7b26\u4e32"),"\uff0c\u5e76\u4e14\u5728\u5217\u8868\u4e2d\u6bcf\u6b21\u5143\u7d20 ",(0,o.kt)("inlineCode",{parentName:"p"},"re-render")," \u65f6 ",(0,o.kt)("inlineCode",{parentName:"p"},"key")," \u90fd\u9700\u8981\u4fdd\u6301\u4e00\u81f4"),(0,o.kt)("p",null,"\u901a\u5e38 ",(0,o.kt)("inlineCode",{parentName:"p"},"item")," \u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"id")," \u6216\u6570\u7ec4\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"index")," \u53ef\u4ee5\u7528\u6765\u5f53\u505a ",(0,o.kt)("inlineCode",{parentName:"p"},"key")),(0,o.kt)("p",null,"\u5982\u679c\u5217\u8868\u662f",(0,o.kt)("strong",{parentName:"p"},"\u9759\u6001"),"\u7684\uff0c\u5373\u5143\u7d20\u4e0d\u4f1a\u6dfb\u52a0/\u5220\u9664/\u63d2\u5165/\u91cd\u65b0\u6392\u5e8f\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u6570\u7ec4\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"index")," \u4f5c\u4e3a ",(0,o.kt)("inlineCode",{parentName:"p"},"key")),(0,o.kt)("p",null,"but\uff0c\u5728",(0,o.kt)("strong",{parentName:"p"},"\u52a8\u6001"),"\u5217\u8868\u4e2d\uff0c\u4f7f\u7528\u6570\u7ec4 ",(0,o.kt)("inlineCode",{parentName:"p"},"index")," \u4f5c\u4e3a ",(0,o.kt)("inlineCode",{parentName:"p"},"key")," \u5c31\u6709\u95ee\u9898\u4e86"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u6709 ",(0,o.kt)("inlineCode",{parentName:"li"},"state")," \u6216 \u4e0d\u53d7\u63a7\u7684\u5143\u7d20\uff08\u5982 form inputs\uff09\u7684\u8bdd\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u9519\u8bef"),(0,o.kt)("li",{parentName:"ul"},"\u5982\u679c ",(0,o.kt)("inlineCode",{parentName:"li"},"items")," \u88ab ",(0,o.kt)("inlineCode",{parentName:"li"},"React.memo")," \u5305\u88f9\uff0c\u6027\u80fd\u4f1a\u4e0b\u964d")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="\u9759\u6001\u5217\u8868\uff0c\u65e0\u533a\u522b"',title:'"\u9759\u6001\u5217\u8868\uff0c\u65e0\u533a\u522b"'},'const Child = ({ value }: { value: number }) => {\n  console.log("Child re-renders", value);\n  return <div>{value}</div>;\n};\n\nconst values = [1,2,3]\n\nconst ChildMemo = React.memo(Child)\n\nconst Component = () => {\n  const [state, setState] = useState(0)\n  const handleClick = () => {\n    setState(state + 1)\n  }\n\n  return (\n    <>\n      <button onClick={() => handleClick()}>click here {state}</button>\n      <br/>\n      {values.map((val,idx) => (<ChildMemo value={val} key={idx} />))}\n      <br/>\n      {values.map((val) => (<ChildMemo value={val} key={val} />))}\n    </>\n  )\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="\u52a8\u6001\u5217\u8868\uff0c\u7d22\u5f15\u7c97\u95ee\u9898\u4e86"',title:'"\u52a8\u6001\u5217\u8868\uff0c\u7d22\u5f15\u7c97\u95ee\u9898\u4e86"'},'const Child = ({ value }: { value: number }) => {\n  console.log("Child re-renders", value);\n  return <div>{value}</div>;\n};\n\nconst values = [1,2,3]\n\nconst ChildMemo = React.memo(Child)\n\nconst Component = () => {\n  const [state, setState] = useState(false)\n  const handleClick = () => {\n    setState(!state)\n  }\n\n  const sortedValues = state ? values.sort() : values.sort().reverse()\n\n  return (\n    <>\n      <button onClick={() => handleClick()}>click here {state}</button>\n      <br/>\n      {/* \u7528 React.memo \u5305\u88f9\u4e5f gg\uff0c\u8fd8\u662f\u89e6\u53d1\u4e86 re-render */}\n      {sortedValues.map((val, index) => (<ChildMemo value={`child of index: ${val}` key={index}} />))}\n      <br/>\n      {/* \u6ca1\u89e6\u53d1 re-render */}\n      {sortedValues.map((val) => (<ChildMemo value={`child of val: ${val}` key={val}} />))}\n    </>\n  )\n}\n')),(0,o.kt)("h3",{id:"51-\u53cd\u6a21\u5f0f\u4f7f\u7528\u968f\u673a\u6570\u4f5c\u4e3a\u5217\u8868\u7684-key"},"\u26d45.1 \u53cd\u6a21\u5f0f\uff1a\u4f7f\u7528\u968f\u673a\u6570\u4f5c\u4e3a\u5217\u8868\u7684 key"),(0,o.kt)("p",null,"\u8fd9\u4e2a\u662f\u5fc5\u9700\u5fc5\u9700\u5fc5\u9700\u907f\u514d\u7684\u884c\u4e3a\uff0c\u6253\u6b7b\u4e5f\u4e0d\u80fd\u7528\u968f\u673a\u6570\u4f5c\u4e3a\u5217\u8868\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"key"),"\uff0c\u56e0\u4e3a\u4f1a\u5bfc\u81f4 React \u5728",(0,o.kt)("strong",{parentName:"p"},"\u6bcf\u6b21 re-render")," \u65f6\u90fd ",(0,o.kt)("inlineCode",{parentName:"p"},"re-mount")," \u5143\u7d20\uff0c\u8fdb\u800c"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u5217\u8868\u6027\u80fd\u7cdf\u7cd5"),(0,o.kt)("li",{parentName:"ul"},"\u6709 ",(0,o.kt)("inlineCode",{parentName:"li"},"state")," \u6216 \u4efb\u4f55\u4e0d\u53d7\u63a7\u5143\u7d20\uff08\u5982 form inputs\uff09\u65f6\u51fa\u73b0\u9519\u8bef")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'const Child = ({ value }: { value: number }) => {\n  console.log("Child re-renders", value);\n\n  useEffect(() => {\n    console.log("Child re-mounts");\n  }, []);\n  return <div>{value}</div>;\n};\n\nconst values = [1,2,3]\n\nconst ChildMemo = React.memo(Child)\n\nconst Component = () => {\n  const [state, setState] = useState(0)\n  const handleClick = () => {\n    setState(state + 1)\n  }\n\n  return (\n    <>\n      <button onClick={() => handleClick()}>click here {state}</button>\n      <br/>\n      {/* \u5bfc\u81f4 re-mounts every render ! */}\n      {values.map((val) => (<ChildMemo value={val} key={Math.random()} />))}\n    </>\n  )\n}\n')))}m.isMDXComponent=!0}}]);