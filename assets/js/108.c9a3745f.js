(window.webpackJsonp=window.webpackJsonp||[]).push([[108],{377:function(t,s,a){"use strict";a.r(s);var e=a(10),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"初探travis-ci-实现vuepress自动化部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初探travis-ci-实现vuepress自动化部署"}},[t._v("#")]),t._v(" 初探Travis CI: 实现VuePress自动化部署")]),t._v(" "),s("h2",{attrs:{id:"背景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),s("p",[t._v("之前使用VuePress写博客是 "),s("code",[t._v("写md文档")]),t._v(" => "),s("code",[t._v("提交github")]),t._v(" => "),s("code",[t._v("使用配好的deploy.sh文件发布")]),t._v("这样一个流程。\n"),s("code",[t._v("deploy.sh文件")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/usr/bin/env sh")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 确保脚本抛出遇到的错误")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" -e\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生成静态文件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run docs:build\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入生成的文件夹")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" docs/.vuepress/dist\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# git init 官网是有这行的，但我的项目里给注释掉了，因为我是现有项目，不想每次都初始化")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" init\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" -A\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -m "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'deploy'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" config --local user.name "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fxpby"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" config --local user.email "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fxpby@outlook.com"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" push -f https://github.com/fxpby/myblog.git master:gh-pages\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd -")]),t._v("\n")])])]),s("p",[t._v("虽然已经半自动化了，但是感觉还是有些麻烦的，要是可以代码push后自动部署发布就舒服了，搜了下相关资料，看上了"),s("code",[t._v("Travis CI")]),t._v("，原因是觉得他logo比较酷😎，哈哈，其实是因为配置简洁，市场份额大，还免费🤞。")]),t._v(" "),s("h2",{attrs:{id:"安装配置vuepress"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装配置vuepress"}},[t._v("#")]),t._v(" 安装配置VuePress")]),t._v(" "),s("p",[t._v("嘿嘿，说声抱歉，VuePress如何安装配置这里就不详细介绍了，官网文档详细的，本文主角是集成Travis CI😇，vitepress也出来好久了，回头感兴趣也去试试他。")]),t._v(" "),s("h2",{attrs:{id:"集成travis-ci"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#集成travis-ci"}},[t._v("#")]),t._v(" 集成Travis CI")]),t._v(" "),s("p",[t._v("Travis CI使用它的前提是：")]),t._v(" "),s("ul",[s("li",[t._v("有github账号（目前bitbucket、gitlab和assembla好像也支持了）")]),t._v(" "),s("li",[t._v("账号里有项目")]),t._v(" "),s("li",[t._v("项目里代码可以跑")]),t._v(" "),s("li",[t._v("项目包含构建脚本")])]),t._v(" "),s("h3",{attrs:{id:"创建-travis-yml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建-travis-yml"}},[t._v("#")]),t._v(" 创建.travis.yml")]),t._v(" "),s("p",[t._v("在项目根目录新建"),s("code",[t._v(".travis.yml")]),t._v("文件，前面有"),s("code",[t._v(".")]),t._v("哦")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("language")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node_js\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node_js")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" lts/*\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("install")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm install\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("directories")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node_modules"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm run docs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("build\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("provider")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pages\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("skip-cleanup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("local_dir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docs/.vuepress/dist \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("github-token")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $GITHUB_TOKEN "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# a token generated on github allowing travis to push code on you repository")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keep-history")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" master\n")])])]),s("h3",{attrs:{id:"设置github"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置github"}},[t._v("#")]),t._v(" 设置github")]),t._v(" "),s("h4",{attrs:{id:"手动创建一个gh-pages分支"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#手动创建一个gh-pages分支"}},[t._v("#")]),t._v(" 手动创建一个gh-pages分支")]),t._v(" "),s("p",[t._v("在"),s("code",[t._v("Source")]),t._v("中选择"),s("code",[t._v("gh-pages")]),t._v("分支，以后我们生成的静态文件存放在这里")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fxpby.oss-cn-beijing.aliyuncs.com/blogImg/front-end-enginerring/github-page.png",alt:"github-pages-config"}})]),t._v(" "),s("h4",{attrs:{id:"创建github-token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建github-token"}},[t._v("#")]),t._v(" 创建github token")]),t._v(" "),s("p",[t._v("点击我们右上角的个人头像，点击"),s("code",[t._v("Settings")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fxpby.oss-cn-beijing.aliyuncs.com/blogImg/front-end-enginerring/github-setting.png",alt:"settings"}})]),t._v(" "),s("p",[t._v("来到"),s("code",[t._v("Developer settings")]),t._v("，点击"),s("code",[t._v("Personal access tokens")]),t._v("， 再点击"),s("code",[t._v("Generate new token")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fxpby.oss-cn-beijing.aliyuncs.com/blogImg/front-end-enginerring/setting-personal-access-tokens.png",alt:"Personal access tokens"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fxpby.oss-cn-beijing.aliyuncs.com/blogImg/front-end-enginerring/generate-new-token.png",alt:"generate new token"}})]),t._v(" "),s("p",[t._v("接下来选择权限, "),s("code",[t._v("Note")]),t._v("随便写，下面权限的话勾选如图所示，保存后会得到"),s("code",[t._v("Personal access tokens")]),t._v("一个token串，只展示一次，这个请妥善保存，以后如果想访问需要更新")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fxpby.oss-cn-beijing.aliyuncs.com/blogImg/front-end-enginerring/select-access.png",alt:"select oauth"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fxpby.oss-cn-beijing.aliyuncs.com/blogImg/front-end-enginerring/access-tokens.png",alt:"access-tokens"}})]),t._v(" "),s("h3",{attrs:{id:"配置travis-ci"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置travis-ci"}},[t._v("#")]),t._v(" 配置Travis CI")]),t._v(" "),s("p",[t._v("现在我们有了项目，有了构建脚本，有了github的token, 还差对Travis CI进行一些配置，离成功只差一步🤩")]),t._v(" "),s("p",[t._v("首先呢注册登录Travis CI "),s("a",{attrs:{href:"https://app.travis-ci.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://app.travis-ci.com/"),s("OutboundLink")],1)]),t._v(" "),s("h4",{attrs:{id:"仓库授权"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#仓库授权"}},[t._v("#")]),t._v(" 仓库授权")]),t._v(" "),s("p",[t._v("对github仓库进行授权，可以选择所有或者指定仓库")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fxpby.oss-cn-beijing.aliyuncs.com/blogImg/front-end-enginerring/repository-access.png",alt:"repo-access"}})]),t._v(" "),s("h4",{attrs:{id:"环境变量设置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境变量设置"}},[t._v("#")]),t._v(" 环境变量设置")]),t._v(" "),s("p",[t._v("选择我们github中的目标仓库，来到"),s("code",[t._v("Environment Variables")]),t._v("， "),s("code",[t._v("NAME")]),t._v("填写之前我们在"),s("code",[t._v(".travis.yml")]),t._v("中写的"),s("code",[t._v("github-token")]),t._v(" "),s("code",[t._v("GITHUB_TOKEN")]),t._v("，还记得上一步"),s("code",[t._v("Personal access tokens")]),t._v("得到的token串吗，"),s("code",[t._v("VALUE")]),t._v("这里把它填进去，后面的开关也打开，最后点击"),s("code",[t._v("Add")]),t._v("按钮")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fxpby.oss-cn-beijing.aliyuncs.com/blogImg/front-end-enginerring/environment-variables.png",alt:"environment-variables"}})]),t._v(" "),s("p",[t._v("至此，所有配置已经完成，来试一下效果😉")]),t._v(" "),s("h3",{attrs:{id:"测试效果"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试效果"}},[t._v("#")]),t._v(" 测试效果")]),t._v(" "),s("p",[t._v("修改代码，push上去，在Travis CI会看到构建日志，最终得到构建成功的推送，不到两分钟，还是蛮快的呢🥳\n"),s("img",{attrs:{src:"https://fxpby.oss-cn-beijing.aliyuncs.com/blogImg/front-end-enginerring/build-success.png",alt:"build-success"}})]),t._v(" "),s("h2",{attrs:{id:"reference"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reference"}},[t._v("#")]),t._v(" Reference")]),t._v(" "),s("blockquote",[s("p",[s("a",{attrs:{href:"https://docs.github.com/en/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.github.com/en/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site"),s("OutboundLink")],1),t._v(" "),s("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2017/12/travis_ci_tutorial.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://www.ruanyifeng.com/blog/2017/12/travis_ci_tutorial.html"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=n.exports}}]);