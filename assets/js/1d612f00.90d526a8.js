"use strict";(self.webpackChunkmy_website_2=self.webpackChunkmy_website_2||[]).push([[5023],{28453:(n,e,t)=>{t.d(e,{R:()=>r,x:()=>d});var i=t(96540);const s={},a=i.createContext(s);function r(n){const e=i.useContext(a);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:r(n.components),i.createElement(a.Provider,{value:e},n.children)}},50463:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>d,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"coding/design-pattern/comprehensive-application-case","title":"\u6a21\u62df\u8d2d\u7269\u8f66","description":"\u529f\u80fd\u70b9","source":"@site/docs/coding/design-pattern/comprehensive-application-case.md","sourceDirName":"coding/design-pattern","slug":"/coding/design-pattern/comprehensive-application-case","permalink":"/myblog/docs/coding/design-pattern/comprehensive-application-case","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/coding/design-pattern/comprehensive-application-case.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u7ec4\u5408\u6a21\u5f0f Composite Pattern","permalink":"/myblog/docs/coding/design-pattern/composite-pattern-basics"},"next":{"title":"\u88c5\u9970\u5668\u6a21\u5f0f Decorator Pattern","permalink":"/myblog/docs/coding/design-pattern/decorator-pattern-basics"}}');var s=t(74848),a=t(28453);const r={},d="\u6a21\u62df\u8d2d\u7269\u8f66",l={},o=[{value:"\u529f\u80fd\u70b9",id:"\u529f\u80fd\u70b9",level:2},{value:"\u8bbe\u8ba1\u6a21\u5f0f",id:"\u8bbe\u8ba1\u6a21\u5f0f",level:2},{value:"UML\u7c7b\u56fe",id:"uml\u7c7b\u56fe",level:2},{value:"\u5b9e\u8df5",id:"\u5b9e\u8df5",level:2},{value:"\u76ee\u5f55\u7ed3\u6784",id:"\u76ee\u5f55\u7ed3\u6784",level:3},{value:"\u4ee3\u7801",id:"\u4ee3\u7801",level:3}];function c(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"\u6a21\u62df\u8d2d\u7269\u8f66",children:"\u6a21\u62df\u8d2d\u7269\u8f66"})}),"\n",(0,s.jsx)(e.h2,{id:"\u529f\u80fd\u70b9",children:"\u529f\u80fd\u70b9"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u663e\u793a\u8d2d\u7269\u5217\u8868"}),"\n",(0,s.jsx)(e.li,{children:"\u52a0\u5165\u8d2d\u7269\u8f66"}),"\n",(0,s.jsx)(e.li,{children:"\u4ece\u8d2d\u7269\u8f66\u5220\u9664"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"\u8bbe\u8ba1\u6a21\u5f0f",children:"\u8bbe\u8ba1\u6a21\u5f0f"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5de5\u5382\u6a21\u5f0f"}),"\n",(0,s.jsx)(e.li,{children:"\u5355\u4f8b\u6a21\u5f0f"}),"\n",(0,s.jsx)(e.li,{children:"\u88c5\u9970\u5668\u6a21\u5f0f"}),"\n",(0,s.jsx)(e.li,{children:"\u89c2\u5bdf\u8005\u6a21\u5f0f"}),"\n",(0,s.jsx)(e.li,{children:"\u72b6\u6001\u6a21\u5f0f"}),"\n",(0,s.jsx)(e.li,{children:"\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f"}),"\n",(0,s.jsx)(e.li,{children:"\u4ee3\u7406\u6a21\u5f0f"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"uml\u7c7b\u56fe",children:"UML\u7c7b\u56fe"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-mermaid",children:"classDiagram\n\nDemo --\x3e App\nApp <-- List\nApp <-- ShoppingCart\nItem <-- List\nCart <-- Item\nShoppingCart --\x3e Cart\n\nclass Demo {\n  + app: App\n  +main () void\n}\n\nclass App {\n  +init() void\n  -initShoppingCart() void\n  -initList() void\n}\n\nclass List {\n  - app: App\n  +init() void\n  -loadData() Promise\n  -initItemList(data) void\n  -render() void\n}\n\nclass Item {\n  - list: List\n  - data: Object\n  - cart: Cart\n  +init() void\n  -initShoppingCart() void\n  -initList() void\n  -addToCartHandler() void\n  -deleteFromCartHandler() void\n  -render() void\n}\n\nclass Cart {\n  - list: Array\n  + add(data) void\n  + del(id) void\n  + getList(): String\n}\n\nclass ShoppingCart {\n  - app: App\n  - cart: Cart\n  +init() void\n  -initBtn() void\n  -showCart() void\n  -render() void\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u5b9e\u8df5",children:"\u5b9e\u8df5"}),"\n",(0,s.jsx)(e.h3,{id:"\u76ee\u5f55\u7ed3\u6784",children:"\u76ee\u5f55\u7ed3\u6784"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"index.js"}),"\n",(0,s.jsxs)(e.li,{children:["index.html","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Demo","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["List","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"CreateItem.js"}),"\n",(0,s.jsx)(e.li,{children:"Item.js"}),"\n",(0,s.jsx)(e.li,{children:"List.js"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["ShoppingCart","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"GetCart.js"}),"\n",(0,s.jsx)(e.li,{children:"ShoppingCart.js"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["util","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"log.js"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"App.js"}),"\n",(0,s.jsx)(e.li,{children:"data.json"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u4ee3\u7801",children:"\u4ee3\u7801"}),"\n",(0,s.jsx)(e.p,{children:"index.html \u5165\u53e3\u6a21\u677f"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-html",children:'<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta http-equiv="X-UA-Compatible" content="IE=edge">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>\u6a21\u62df\u8d2d\u7269\u8f66</title>\n</head>\n<body>\n  <div id="app"></div>\n</body>\n<script src="./index.js"><\/script>\n</html>\n'})}),"\n",(0,s.jsx)(e.p,{children:"index.js \u5165\u53e3\u6587\u4ef6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"import App from './demo/App.js'\n\nconst app = new App('app')\napp.init('app')\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5546\u54c1\u5904\u7406\ndemo/List/CreateItem.js"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"import Item from './Item.js'\n\n// \u5de5\u5382\u51fd\u6570 - \u5de5\u5382\u6a21\u5f0f\nexport default function (list, itemData) {\n  if (itemData.discount) {\n    itemData = createDiscount(itemData)\n  }\n  return new Item(list, itemData)\n}\n\n// \u4ee3\u7406\u6a21\u5f0f, \u611f\u89c9\u8fd9\u91cc\u7528\u6709\u4e9b\u751f\u786c\nconst createDiscount = itemData => {\n  return new Proxy(itemData, {\n    get: (target, key) => {\n      if (key === 'name') {\n        return `${target[key]}\u3010\u6298\u6263\ud83d\udcb0\u3011`\n      }\n      if (key === 'price') {\n        return target[key] * 0.8\n      }\n      return target[key]\n    }\n  })\n}\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5546\u54c1\u5217\u8868\u9879\u7c7b\ndemo/List/Item.js"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"import getCart from '../ShoppingCart/GetCart.js'\nimport StateMachine from 'javascript-state-machine'\nimport { log } from './../util/log.js'\nexport default class Item {\n  constructor(list, data) {\n    this.list = list\n    this.data = data\n    this.$el = document.createElement(\"DIV\")\n    this.cart = getCart && getCart()\n  }\n\n  initContent() {\n    const $el = this.$el\n    const data = this.data\n    const nameDom = document.createElement(\"P\")\n    nameDom.innerHTML = `\u540d\u79f0\uff1a${data.name}`\n    const priceDom = document.createElement(\"P\")\n    priceDom.innerHTML = `\u4ef7\u683c\uff1a${data.price}`\n    $el.append(nameDom)\n    $el.append(priceDom)\n  }\n\n  initBtn() {\n    const $el = this.$el\n    const btn = document.createElement(\"BUTTON\")\n    \n    // \u72b6\u6001\u6a21\u5f0f\n    const fsm = new StateMachine({\n      init: '\u52a0\u5165\u8d2d\u7269\u8f66',\n      transitions: [\n        {\n          name: 'addToCart',\n          from: '\u52a0\u5165\u8d2d\u7269\u8f66',\n          to: '\u4ece\u8d2d\u7269\u8f66\u5220\u9664'\n        },\n        { \n          name: 'deleteFromCart',\n          from: '\u4ece\u8d2d\u7269\u8f66\u5220\u9664',\n          to: '\u52a0\u5165\u8d2d\u7269\u8f66'\n        }\n      ],\n      methods: {\n        // \u52a0\u5165\u8d2d\u7269\u8f66\n        onAddToCart: () => {\n          this.addToCartHandler()\n          updateText()\n        },\n        // \u4ece\u8d2d\u7269\u8f66\u5220\u9664\n        onDeleteFromCart: () => {\n          this.deleteFromCartHandler()\n          updateText()\n        }\n      }\n    })\n\n    const updateText = () => {\n      btn.innerHTML = fsm.state\n    }\n    btn.onclick = () => {\n      // \u6dfb\u52a0\u5230\u8d2d\u7269\u8f66\n      if (fsm.is('\u52a0\u5165\u8d2d\u7269\u8f66')) {\n        fsm.addToCart()\n      // \u4ece\u8d2d\u7269\u8f66\u79fb\u9664\n      } else if (fsm.is('\u4ece\u8d2d\u7269\u8f66\u5220\u9664')) {\n        fsm.deleteFromCart()\n      }\n    }\n    updateText()\n    $el.append(btn)\n  }\n\n  @log('add')\n  addToCartHandler() {\n    this.cart.add(this.data)\n  }\n\n  @log('del')\n  deleteFromCartHandler() {\n    this.cart.del(this.data.id)\n  }\n\n  render() {\n    this.list.$el.append(this.$el)\n  }\n\n  init() {\n    this.initContent()\n    this.initBtn()\n    this.render()\n  }\n}\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5546\u54c1\u5217\u8868\u7c7b\ndemo/List/List.js"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"import goodsData from './../data.json'\nimport createItem from './CreateItem.js'\n\nexport default class List {\n  constructor(app) {\n    this.app = app\n    this.$el = document.createElement(\"DIV\")\n  }\n\n  // \u83b7\u53d6\u6570\u636e\n  loadData() {\n    return new Promise(resolve => {\n      resolve(goodsData)\n    })\n  }\n\n  // \u751f\u6210\u5217\u8868\n  initItemList(data) {\n    data.forEach(itemData => {\n      const item = createItem(this, itemData)\n      item.init()\n    })\n  }\n\n  // \u6e32\u67d3\n  render() {\n    this.app.$el.append(this.$el)\n  }\n\n  async init() {\n    const data = await this.loadData()\n    this.initItemList(data)\n    this.render()\n  }\n}\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8d2d\u7269\u8f66\u7c7b\uff08\u5185\u5b58\u903b\u8f91\uff09\ndemo/ShoppingCart/GetCart.js"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"// \u8d2d\u7269\u8f66\u5185\u5b58\nclass Cart {\n  constructor() {\n    this.list = [];\n  }\n\n  add(data) {\n    this.list.push(data)\n  }\n\n  del(id) {\n    const delIndex = this.list.findIndex(x => x.id === id)\n    this.list.splice(delIndex, 1)\n  }\n\n  getList() {\n    return this.list.map(x => x.name)\n  }\n\n  getCart() {\n    return cartInstance\n  }\n}\n\nlet cartInstance = null\n\n// \u8fd4\u56de\u5355\u4f8b - \u5355\u4f8b\u6a21\u5f0f\nconst getCart = (() => () => {\n  if (!cartInstance) {\n    cartInstance = new Cart()\n  }\n  return cartInstance\n})()\n\nexport default getCart\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8d2d\u7269\u8f66\u5bb9\u5668\u7c7b\ndemo/ShoppingCart/shoppingCart.js"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"import getCart from '../ShoppingCart/GetCart.js'\n\nexport default class ShoppingCart {\n  constructor(app) {\n    this.app = app\n    this.$el = document.createElement('div')\n    this.cart = getCart && getCart()\n  }\n\n  initBtn() {\n    const btnDom = document.createElement('button')\n    btnDom.innerHTML = '\u8d2d\u7269\u8f66'\n    btnDom.onclick = () => {\n      this.showCart()\n    }\n    this.$el.append(btnDom)\n  }\n\n  showCart() {\n    console.log(this.cart.getList())\n  }\n\n  render() {\n    this.app.$el.append(this.$el)\n  }\n\n  init() {\n    this.initBtn()\n    this.render()\n  }\n}\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u65e5\u5fd7\u4e0a\u62a5\u5904\u7406\ndemo/util/log.js"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"// \u88c5\u9970\u5668\u6a21\u5f0f\nconst log = type => (target, name, descriptor) => {\n  const oldValue = descriptor.value\n  descriptor.value = function() {\n    console.log(`\u65e5\u5fd7\u4e0a\u62a5 ${type}`)\n    return oldValue.apply(this, arguments)\n  }\n  return descriptor\n}\n\nexport { log }\n"})}),"\n",(0,s.jsx)(e.p,{children:"App \u7c7b\ndemo/App.js"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"import ShoppingCart from './ShoppingCart/ShoppingCart'\nimport List from './List/List'\n\nexport default class App {\n  constructor(id) {\n    this.$el = document.getElementById(`${id}`);\n  }\n\n  // \u521d\u59cb\u5316\u8d2d\u7269\u8f66\n  initShoppingCart() {\n    const shoppingCart = new ShoppingCart(this)\n    shoppingCart.init()\n  }\n\n  // \u521d\u59cb\u5316\u5217\u8868\n  initList() {\n    const list = new List(this)\n    list.init()\n  }\n\n  init() {\n    this.initShoppingCart()\n    this.initList()\n  }\n}\n"})}),"\n",(0,s.jsx)(e.p,{children:"mock \u6570\u636e\ndemo/data.json"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'[\n  {\n    "id": 1,\n    "name": "aaa",\n    "price": 111,\n    "discount": 1\n  },\n  {\n    "id": 2,\n    "name": "bbb",\n    "price": 222,\n    "discount": 1\n  },\n  {\n    "id": 3,\n    "name": "ccc",\n    "price": 333,\n    "discount": 0\n  },\n  {\n    "id": 4,\n    "name": "ddd",\n    "price": 444,\n    "discount": 0\n  }\n]\n'})})]})}function p(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(c,{...n})}):c(n)}}}]);