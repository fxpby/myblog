"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5739],{3905:(n,t,e)=>{e.d(t,{Zo:()=>c,kt:()=>u});var a=e(67294);function i(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function r(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,a)}return e}function l(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?r(Object(e),!0).forEach((function(t){i(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):r(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function p(n,t){if(null==n)return{};var e,a,i=function(n,t){if(null==n)return{};var e,a,i={},r=Object.keys(n);for(a=0;a<r.length;a++)e=r[a],t.indexOf(e)>=0||(i[e]=n[e]);return i}(n,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(a=0;a<r.length;a++)e=r[a],t.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(n,e)&&(i[e]=n[e])}return i}var o=a.createContext({}),s=function(n){var t=a.useContext(o),e=t;return n&&(e="function"==typeof n?n(t):l(l({},t),n)),e},c=function(n){var t=s(n.components);return a.createElement(o.Provider,{value:t},n.children)},d={inlineCode:"code",wrapper:function(n){var t=n.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(n,t){var e=n.components,i=n.mdxType,r=n.originalType,o=n.parentName,c=p(n,["components","mdxType","originalType","parentName"]),m=s(e),u=i,h=m["".concat(o,".").concat(u)]||m[u]||d[u]||r;return e?a.createElement(h,l(l({ref:t},c),{},{components:e})):a.createElement(h,l({ref:t},c))}));function u(n,t){var e=arguments,i=t&&t.mdxType;if("string"==typeof n||i){var r=e.length,l=new Array(r);l[0]=m;var p={};for(var o in t)hasOwnProperty.call(t,o)&&(p[o]=t[o]);p.originalType=n,p.mdxType="string"==typeof n?n:i,l[1]=p;for(var s=2;s<r;s++)l[s]=e[s];return a.createElement.apply(null,l)}return a.createElement.apply(null,e)}m.displayName="MDXCreateElement"},16067:(n,t,e)=>{e.r(t),e.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>p,toc:()=>s});var a=e(87462),i=(e(67294),e(3905));const r={},l="\u6a21\u62df\u8d2d\u7269\u8f66",p={unversionedId:"design-pattern/comprehensive-application/comprehensive-application-case",id:"design-pattern/comprehensive-application/comprehensive-application-case",title:"\u6a21\u62df\u8d2d\u7269\u8f66",description:"\u529f\u80fd\u70b9",source:"@site/docs/design-pattern/comprehensive-application/comprehensive-application-case.md",sourceDirName:"design-pattern/comprehensive-application",slug:"/design-pattern/comprehensive-application/comprehensive-application-case",permalink:"/myblog/docs/design-pattern/comprehensive-application/comprehensive-application-case",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/design-pattern/comprehensive-application/comprehensive-application-case.md",tags:[],version:"current",frontMatter:{},sidebar:"design-pattern",previous:{title:"\u4e2d\u4ecb\u8005\u6a21\u5f0f Mediator Pattern",permalink:"/myblog/docs/design-pattern/mediator-pattern/mediator-pattern-basics"}},o={},s=[{value:"\u529f\u80fd\u70b9",id:"\u529f\u80fd\u70b9",level:2},{value:"\u8bbe\u8ba1\u6a21\u5f0f",id:"\u8bbe\u8ba1\u6a21\u5f0f",level:2},{value:"UML\u7c7b\u56fe",id:"uml\u7c7b\u56fe",level:2},{value:"\u5b9e\u8df5",id:"\u5b9e\u8df5",level:2},{value:"\u76ee\u5f55\u7ed3\u6784",id:"\u76ee\u5f55\u7ed3\u6784",level:3},{value:"\u4ee3\u7801",id:"\u4ee3\u7801",level:3}],c={toc:s};function d(n){let{components:t,...e}=n;return(0,i.kt)("wrapper",(0,a.Z)({},c,e,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"\u6a21\u62df\u8d2d\u7269\u8f66"},"\u6a21\u62df\u8d2d\u7269\u8f66"),(0,i.kt)("h2",{id:"\u529f\u80fd\u70b9"},"\u529f\u80fd\u70b9"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u663e\u793a\u8d2d\u7269\u5217\u8868"),(0,i.kt)("li",{parentName:"ul"},"\u52a0\u5165\u8d2d\u7269\u8f66"),(0,i.kt)("li",{parentName:"ul"},"\u4ece\u8d2d\u7269\u8f66\u5220\u9664")),(0,i.kt)("h2",{id:"\u8bbe\u8ba1\u6a21\u5f0f"},"\u8bbe\u8ba1\u6a21\u5f0f"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u5de5\u5382\u6a21\u5f0f"),(0,i.kt)("li",{parentName:"ul"},"\u5355\u4f8b\u6a21\u5f0f"),(0,i.kt)("li",{parentName:"ul"},"\u88c5\u9970\u5668\u6a21\u5f0f"),(0,i.kt)("li",{parentName:"ul"},"\u89c2\u5bdf\u8005\u6a21\u5f0f"),(0,i.kt)("li",{parentName:"ul"},"\u72b6\u6001\u6a21\u5f0f"),(0,i.kt)("li",{parentName:"ul"},"\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f"),(0,i.kt)("li",{parentName:"ul"},"\u4ee3\u7406\u6a21\u5f0f")),(0,i.kt)("h2",{id:"uml\u7c7b\u56fe"},"UML\u7c7b\u56fe"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-mermaid"},"classDiagram\n\nDemo --\x3e App\nApp <-- List\nApp <-- ShoppingCart\nItem <-- List\nCart <-- Item\nShoppingCart --\x3e Cart\n\nclass Demo {\n  + app: App\n  +main () void\n}\n\nclass App {\n  +init() void\n  -initShoppingCart() void\n  -initList() void\n}\n\nclass List {\n  - app: App\n  +init() void\n  -loadData() Promise\n  -initItemList(data) void\n  -render() void\n}\n\nclass Item {\n  - list: List\n  - data: Object\n  - cart: Cart\n  +init() void\n  -initShoppingCart() void\n  -initList() void\n  -addToCartHandler() void\n  -deleteFromCartHandler() void\n  -render() void\n}\n\nclass Cart {\n  - list: Array\n  + add(data) void\n  + del(id) void\n  + getList(): String\n}\n\nclass ShoppingCart {\n  - app: App\n  - cart: Cart\n  +init() void\n  -initBtn() void\n  -showCart() void\n  -render() void\n}\n")),(0,i.kt)("h2",{id:"\u5b9e\u8df5"},"\u5b9e\u8df5"),(0,i.kt)("h3",{id:"\u76ee\u5f55\u7ed3\u6784"},"\u76ee\u5f55\u7ed3\u6784"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"index.js"),(0,i.kt)("li",{parentName:"ul"},"index.html",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Demo",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"List",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"CreateItem.js"),(0,i.kt)("li",{parentName:"ul"},"Item.js"),(0,i.kt)("li",{parentName:"ul"},"List.js"))),(0,i.kt)("li",{parentName:"ul"},"ShoppingCart",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"GetCart.js"),(0,i.kt)("li",{parentName:"ul"},"ShoppingCart.js"))),(0,i.kt)("li",{parentName:"ul"},"util",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"log.js"))),(0,i.kt)("li",{parentName:"ul"},"App.js"),(0,i.kt)("li",{parentName:"ul"},"data.json")))))),(0,i.kt)("h3",{id:"\u4ee3\u7801"},"\u4ee3\u7801"),(0,i.kt)("p",null,"index.html \u5165\u53e3\u6a21\u677f"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta http-equiv="X-UA-Compatible" content="IE=edge">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>\u6a21\u62df\u8d2d\u7269\u8f66</title>\n</head>\n<body>\n  <div id="app"></div>\n</body>\n<script src="./index.js"><\/script>\n</html>\n')),(0,i.kt)("p",null,"index.js \u5165\u53e3\u6587\u4ef6"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import App from './demo/App.js'\n\nconst app = new App('app')\napp.init('app')\n")),(0,i.kt)("p",null,"\u5546\u54c1\u5904\u7406\ndemo/List/CreateItem.js"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import Item from './Item.js'\n\n// \u5de5\u5382\u51fd\u6570 - \u5de5\u5382\u6a21\u5f0f\nexport default function (list, itemData) {\n  if (itemData.discount) {\n    itemData = createDiscount(itemData)\n  }\n  return new Item(list, itemData)\n}\n\n// \u4ee3\u7406\u6a21\u5f0f, \u611f\u89c9\u8fd9\u91cc\u7528\u6709\u4e9b\u751f\u786c\nconst createDiscount = itemData => {\n  return new Proxy(itemData, {\n    get: (target, key) => {\n      if (key === 'name') {\n        return `${target[key]}\u3010\u6298\u6263\ud83d\udcb0\u3011`\n      }\n      if (key === 'price') {\n        return target[key] * 0.8\n      }\n      return target[key]\n    }\n  })\n}\n")),(0,i.kt)("p",null,"\u5546\u54c1\u5217\u8868\u9879\u7c7b\ndemo/List/Item.js"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import getCart from '../ShoppingCart/GetCart.js'\nimport StateMachine from 'javascript-state-machine'\nimport { log } from './../util/log.js'\nexport default class Item {\n  constructor(list, data) {\n    this.list = list\n    this.data = data\n    this.$el = document.createElement(\"DIV\")\n    this.cart = getCart && getCart()\n  }\n\n  initContent() {\n    const $el = this.$el\n    const data = this.data\n    const nameDom = document.createElement(\"P\")\n    nameDom.innerHTML = `\u540d\u79f0\uff1a${data.name}`\n    const priceDom = document.createElement(\"P\")\n    priceDom.innerHTML = `\u4ef7\u683c\uff1a${data.price}`\n    $el.append(nameDom)\n    $el.append(priceDom)\n  }\n\n  initBtn() {\n    const $el = this.$el\n    const btn = document.createElement(\"BUTTON\")\n    \n    // \u72b6\u6001\u6a21\u5f0f\n    const fsm = new StateMachine({\n      init: '\u52a0\u5165\u8d2d\u7269\u8f66',\n      transitions: [\n        {\n          name: 'addToCart',\n          from: '\u52a0\u5165\u8d2d\u7269\u8f66',\n          to: '\u4ece\u8d2d\u7269\u8f66\u5220\u9664'\n        },\n        { \n          name: 'deleteFromCart',\n          from: '\u4ece\u8d2d\u7269\u8f66\u5220\u9664',\n          to: '\u52a0\u5165\u8d2d\u7269\u8f66'\n        }\n      ],\n      methods: {\n        // \u52a0\u5165\u8d2d\u7269\u8f66\n        onAddToCart: () => {\n          this.addToCartHandler()\n          updateText()\n        },\n        // \u4ece\u8d2d\u7269\u8f66\u5220\u9664\n        onDeleteFromCart: () => {\n          this.deleteFromCartHandler()\n          updateText()\n        }\n      }\n    })\n\n    const updateText = () => {\n      btn.innerHTML = fsm.state\n    }\n    btn.onclick = () => {\n      // \u6dfb\u52a0\u5230\u8d2d\u7269\u8f66\n      if (fsm.is('\u52a0\u5165\u8d2d\u7269\u8f66')) {\n        fsm.addToCart()\n      // \u4ece\u8d2d\u7269\u8f66\u79fb\u9664\n      } else if (fsm.is('\u4ece\u8d2d\u7269\u8f66\u5220\u9664')) {\n        fsm.deleteFromCart()\n      }\n    }\n    updateText()\n    $el.append(btn)\n  }\n\n  @log('add')\n  addToCartHandler() {\n    this.cart.add(this.data)\n  }\n\n  @log('del')\n  deleteFromCartHandler() {\n    this.cart.del(this.data.id)\n  }\n\n  render() {\n    this.list.$el.append(this.$el)\n  }\n\n  init() {\n    this.initContent()\n    this.initBtn()\n    this.render()\n  }\n}\n")),(0,i.kt)("p",null,"\u5546\u54c1\u5217\u8868\u7c7b\ndemo/List/List.js"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import goodsData from './../data.json'\nimport createItem from './CreateItem.js'\n\nexport default class List {\n  constructor(app) {\n    this.app = app\n    this.$el = document.createElement(\"DIV\")\n  }\n\n  // \u83b7\u53d6\u6570\u636e\n  loadData() {\n    return new Promise(resolve => {\n      resolve(goodsData)\n    })\n  }\n\n  // \u751f\u6210\u5217\u8868\n  initItemList(data) {\n    data.forEach(itemData => {\n      const item = createItem(this, itemData)\n      item.init()\n    })\n  }\n\n  // \u6e32\u67d3\n  render() {\n    this.app.$el.append(this.$el)\n  }\n\n  async init() {\n    const data = await this.loadData()\n    this.initItemList(data)\n    this.render()\n  }\n}\n")),(0,i.kt)("p",null,"\u8d2d\u7269\u8f66\u7c7b\uff08\u5185\u5b58\u903b\u8f91\uff09\ndemo/ShoppingCart/GetCart.js"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"// \u8d2d\u7269\u8f66\u5185\u5b58\nclass Cart {\n  constructor() {\n    this.list = [];\n  }\n\n  add(data) {\n    this.list.push(data)\n  }\n\n  del(id) {\n    const delIndex = this.list.findIndex(x => x.id === id)\n    this.list.splice(delIndex, 1)\n  }\n\n  getList() {\n    return this.list.map(x => x.name)\n  }\n\n  getCart() {\n    return cartInstance\n  }\n}\n\nlet cartInstance = null\n\n// \u8fd4\u56de\u5355\u4f8b - \u5355\u4f8b\u6a21\u5f0f\nconst getCart = (() => () => {\n  if (!cartInstance) {\n    cartInstance = new Cart()\n  }\n  return cartInstance\n})()\n\nexport default getCart\n")),(0,i.kt)("p",null,"\u8d2d\u7269\u8f66\u5bb9\u5668\u7c7b\ndemo/ShoppingCart/shoppingCart.js"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import getCart from '../ShoppingCart/GetCart.js'\n\nexport default class ShoppingCart {\n  constructor(app) {\n    this.app = app\n    this.$el = document.createElement('div')\n    this.cart = getCart && getCart()\n  }\n\n  initBtn() {\n    const btnDom = document.createElement('button')\n    btnDom.innerHTML = '\u8d2d\u7269\u8f66'\n    btnDom.onclick = () => {\n      this.showCart()\n    }\n    this.$el.append(btnDom)\n  }\n\n  showCart() {\n    console.log(this.cart.getList())\n  }\n\n  render() {\n    this.app.$el.append(this.$el)\n  }\n\n  init() {\n    this.initBtn()\n    this.render()\n  }\n}\n")),(0,i.kt)("p",null,"\u65e5\u5fd7\u4e0a\u62a5\u5904\u7406\ndemo/util/log.js"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"// \u88c5\u9970\u5668\u6a21\u5f0f\nconst log = type => (target, name, descriptor) => {\n  const oldValue = descriptor.value\n  descriptor.value = function() {\n    console.log(`\u65e5\u5fd7\u4e0a\u62a5 ${type}`)\n    return oldValue.apply(this, arguments)\n  }\n  return descriptor\n}\n\nexport { log }\n")),(0,i.kt)("p",null,"App \u7c7b\ndemo/App.js"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import ShoppingCart from './ShoppingCart/ShoppingCart'\nimport List from './List/List'\n\nexport default class App {\n  constructor(id) {\n    this.$el = document.getElementById(`${id}`);\n  }\n\n  // \u521d\u59cb\u5316\u8d2d\u7269\u8f66\n  initShoppingCart() {\n    const shoppingCart = new ShoppingCart(this)\n    shoppingCart.init()\n  }\n\n  // \u521d\u59cb\u5316\u5217\u8868\n  initList() {\n    const list = new List(this)\n    list.init()\n  }\n\n  init() {\n    this.initShoppingCart()\n    this.initList()\n  }\n}\n")),(0,i.kt)("p",null,"mock \u6570\u636e\ndemo/data.json"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "id": 1,\n    "name": "aaa",\n    "price": 111,\n    "discount": 1\n  },\n  {\n    "id": 2,\n    "name": "bbb",\n    "price": 222,\n    "discount": 1\n  },\n  {\n    "id": 3,\n    "name": "ccc",\n    "price": 333,\n    "discount": 0\n  },\n  {\n    "id": 4,\n    "name": "ddd",\n    "price": 444,\n    "discount": 0\n  }\n]\n')))}d.isMDXComponent=!0}}]);